"use strict";angular.module("moment",[]).constant("moment",window.moment),angular.module("$",[]).constant("$",window.$),angular.module("videoHub",["$","ngCookies","ngRoute","ngMessages","restangular","BettyCropper","ui.bootstrap","ui.sortable","LocalStorageModule","moment","BulbsAutocomplete","BulbsAutocomplete.suggest.groupBy"]).config(["$locationProvider","$httpProvider","$routeProvider","$sceDelegateProvider","RestangularProvider",function(a,b,c,d){d.resourceUrlWhitelist(["self","http://assets.onionstatic.com/videoads/*","http://onionwebtech.s3.amazonaws.com/**","http://tv.theonion.com/**","http://v.theonion.com/**"]),a.html5Mode(!0),c.when("/cms/",{templateUrl:"components/list-pages/videolist/videolist.html",controller:"VideoListController",reloadOnSearch:!1}).when("/cms/series/",{templateUrl:"components/list-pages/serieslist/serieslist.html",controller:"SeriesListController",reloadOnSearch:!1}).when("/cms/channels/",{templateUrl:"components/list-pages/channellist/channellist.html",controller:"ChannelListController",reloadOnSearch:!1}).when("/cms/sponsors/",{templateUrl:"components/list-pages/sponsorlist/sponsorlist.html",controller:"SponsorListController",reloadOnSearch:!1}).when("/cms/login/",{templateUrl:"components/login/login.html",controller:"LoginController"}).when("/cms/videos/new/",{templateUrl:"components/detail-pages/videodetail/videodetail.html",controller:"VideoDetailController"}).when("/cms/videos/:videoId/",{templateUrl:"components/detail-pages/videodetail/videodetail.html",controller:"VideoDetailController"}).when("/cms/channels/new/",{templateUrl:"components/detail-pages/channeldetail/channeldetail.html",controller:"ChannelDetailController"}).when("/cms/channels/:channelId/",{templateUrl:"components/detail-pages/channeldetail/channeldetail.html",controller:"ChannelDetailController"}).when("/cms/series/new/",{templateUrl:"components/detail-pages/seriesdetail/seriesdetail.html",controller:"SeriesDetailController"}).when("/cms/series/:seriesId/",{templateUrl:"components/detail-pages/seriesdetail/seriesdetail.html",controller:"SeriesDetailController"}).when("/cms/sponsors/new/",{templateUrl:"components/detail-pages/sponsordetail/sponsordetail.html",controller:"SponsorDetailController"}).when("/cms/sponsors/:sponsorId/",{templateUrl:"components/detail-pages/sponsordetail/sponsordetail.html",controller:"SponsorDetailController"}).otherwise({redirectTo:"/cms/"})}]).constant("DetailPageControllerConstants",{SAVED_ALERT_MESSAGE:"Saved",SOMETHING_WENT_WRONG_ALERT_MESSAGE:"Something went wrong with saving. Please call your friendly sysadmin.",PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE:"Please fill in all required fields.",DELETE_SUCCESSFUL:"Delete successful"}),angular.module("videoHub").directive("channelDetailSlide",[function(){return{restrict:"E",scope:{slide:"=slideData",removeFunction:"&",parentForm:"="},templateUrl:"components/detail-pages/channeldetail/channel-detail-slide/channel-detail-slide.html"}}]),angular.module("videoHub").controller("ChannelDetailController",["$scope","$route","ChannelService","$location","AlertService","DetailPageControllerConstants","Restangular","SaveButtonStateService",function(a,b,c,d,e,f,g,h){a.channel={},a.fields={},a.accent_color={},a.slides=[],a.displaySomethingWentWrongAlert=function(){e.error(f.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)},a.validateAccentColorFields=function(a){return 256>=(a>=0)&&_.isNumber(a)?a:""};var i=function(){_.each(a.slides,function(a,b){a.position=b})};a.channelIdFromRoute=b.current.params.channelId,a.getChannel=function(){return a.channelIdFromRoute?c.one(b.current.params.channelId).get().then(function(b){a.channel=b,a.fields.sponsor=a.channel.sponsor,_.forEach(b.slides,function(b){a.slides.push(b)});var c=_.words(b.accent_color);c.length>=1&&(a.accent_color.r=_.parseInt(c[0])||0),c.length>=2&&(a.accent_color.g=_.parseInt(c[1])||0),c.length>=3&&(a.accent_color.b=_.parseInt(c[2])||0)},function(a){console.log(a)}):(a.channel={},void g.restangularizeElement(null,a.channel,"channels"))},a.save=function(){a.channelDetailForm.$valid?(a.channel.sponsor=_.has(a.fields.sponsor,"id")?a.fields.sponsor.id:null,a.channel.accent_color=a.getRGBValueFromFields(),a.channel.slides=a.slides,a.channel.save().then(a.successCallback,a.displaySomethingWentWrongAlert)):_.has(a.channelDetailForm.$error,"number")?e.error("Accent Color values must be numbers.",!0):e.error(f.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},a.getRGBValueFromFields=function(){var b=_.template("<%= r %>,<%= g %>,<%= b %>"),c={r:a.accent_color.r||0,g:a.accent_color.g||0,b:a.accent_color.b||0};return b(c)},a.successCallback=function(c){a.channelDetailForm.$setPristine(),h.displaySavingAnimation().then(function(){_.has(b.current.params,"channelId")||d.path("cms/channels/"+c.id+"/")})},a.$watch("accent_color.r",function(b){a.accent_color.r=a.validateAccentColorFields(b)}),a.$watch("accent_color.g",function(b){a.accent_color.g=a.validateAccentColorFields(b)}),a.$watch("accent_color.b",function(b){a.accent_color.b=a.validateAccentColorFields(b)}),a.dateTimeSelectorCallback=function(b){a.channel.published=b,a.save()},a["delete"]=function(){e.info("If you would like to delete a channel, please contact your friendly sysadmin.",!0)},a.getChannel(),a.sortableOptions={containment:"document",opacity:.75,placeholder:"dropzone",stop:function(){a.channelDetailForm.$setDirty(),i()}},a.addSlide=function(){_.isArray(a.slides)||(a.slides=[]),a.slides.push({}),a.channelDetailForm.$setDirty(),i()},a.removeSlide=function(b){if(b){var c=_.findIndex(a.slides,b);c>=0&&(a.slides.splice(c,1),a.channelDetailForm.$setDirty(),i())}}}]),angular.module("videoHub").directive("seasons",function(){return{templateUrl:"components/detail-pages/seriesdetail/seasons.html",restrict:"E",scope:{seasonsList:"=",updateCallback:"&"},controller:["$scope",function(a){a.addSeason=function(){a.seasonsList.push({sequence:a.seasonsList.length,name:"Season "+(a.seasonsList.length+1)}),a.updateCallback()}}]}}),angular.module("videoHub").controller("SeriesDetailController",["$scope","$route","SeriesService","$location","AlertService","Restangular","DetailPageControllerConstants","SaveButtonStateService",function(a,b,c,d,e,f,g,h){a.series={},a.data={},a.seriesIdFromRouteParams=b.current.params.seriesId,a.getSeries=function(){return a.seriesIdFromRouteParams?c.one(a.seriesIdFromRouteParams).get().then(function(b){a.series=b,a.dropdownFields.channel=b.channel,a.data.sponsor=b.sponsor,_.isUndefined(b.published)||(a.data.published=b.published)},function(a){console.log(a)}):(a.series={},f.restangularizeElement(null,a.series,"series"),a.sponsor={},void 0)},a.save=function(){a.seriesDetailForm.$valid?(a.series.channel=_.has(a.dropdownFields.channel,"id")?a.dropdownFields.channel.id:null,a.series.sponsor=_.has(a.data.sponsor,"id")?a.data.sponsor.id:null,a.series.published=_.isEmpty(a.data.published)?null:a.data.published,a.series.save().then(a.successCallback,a.displaySomethingWentWrongAlert)):e.error(g.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},a.successCallback=function(c){a.seriesDetailForm.$setPristine(),h.displaySavingAnimation().then(function(){_.has(b.current.params,"seriesId")||d.path("cms/series/"+c.id)})},a.displaySomethingWentWrongAlert=function(){e.error(g.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)},a.dateTimeSelectorCallback=function(b){a.data.published=b,a.save()},a["delete"]=function(){e.info("If you would like to delete a series, please contact your friendly sysadmin.",!0)},a.dropdownFields={},a.getSeries()}]),angular.module("videoHub").controller("SponsorDetailController",["$scope","$route","SponsorService","$location","AlertService","Restangular","DetailPageControllerConstants","SaveButtonStateService",function(a,b,c,d,e,f,g,h){a.sponsor={},a.hideDatetimeSelectionModal=!0,a.sponsorIdFromRoute=b.current.params.sponsorId,a.getSponsor=function(){return a.sponsorIdFromRoute?c.one(b.current.params.sponsorId).get().then(function(b){a.sponsor=b},function(a){console.log(a)}):(a.sponsor={},void f.restangularizeElement(null,a.sponsor,"sponsors"))},a.save=function(){a.sponsorDetailForm.$valid?a.sponsor.save().then(a.successCallback,a.displaySomethingWentWrongAlert):e.error(g.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},a.successCallback=function(c){a.sponsorDetailForm.$setPristine(),h.displaySavingAnimation().then(function(){_.has(b.current.params,"sponsorId")||d.path("cms/sponsors/"+c.id)})},a.displaySomethingWentWrongAlert=function(){e.error(g.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)},a["delete"]=function(){e.info("If you would like to delete a sponsor, please contact your friendly sysadmin.",!0)},a.getSponsor()}]),angular.module("videoHub").directive("channelSelection",["DropdownFilterService",function(a){return{templateUrl:"components/detail-pages/videodetail/channelselection/channelselection.html",transclude:!0,link:function(b){b.data=a.data,b.channelFieldChanged=function(){a.setChannel(b.data.channel)},b.seriesFieldChanged=function(){a.setSeries(b.data.series)},a.populateChannelList()}}}]),angular.module("videoHub").service("DropdownFilterService",["ChannelService","SeriesService","SeasonService",function(a,b,c){var d=this;d.data={},d.filter={},d.setChannel=function(a){a?(d.data.channel=a,d.updateFilter(),d.setSeries(null),d.populateSeriesList()):d.clear()},d.setSeries=function(a){a?(d.data.series=a,d.updateFilter(),d.populateSeasonList()):(d.data.series=null,d.data.season=null)},d.setSeason=function(a){a?(d.data.season=a,d.season=a):d.season=null},d.setChannelList=function(a){d.data.channelList=a},d.clear=function(){d.data.channel=null,d.data.series=null,d.data.season=null},d.updateFilter=function(){d.filter.channelId=_.has(d.data.channel,"id")?d.data.channel.id:null,d.filter.seriesId=_.has(d.data.series,"id")?d.data.series.id:null},d.populateChannelList=function(){return a.getList({page_size:100}).then(d.setChannelList)},d.populateSeriesList=function(){return b.getList({page_size:100,f:"channel:"+d.filter.channelId}).then(function(a){d.data.seriesList=a})},d.populateSeasonList=function(){return c.getList({page_size:100,f:"series:"+d.filter.seriesId}).then(function(a){d.data.seasonList=a})}}]),angular.module("videoHub").controller("VideoDetailController",["$scope","$route","VideoService","$location","SaveButtonStateService","DropdownFilterService","Restangular","DetailPageControllerConstants","AlertService",function(a,b,c,d,e,f,g,h,i){a.video={},a.data={},a.videoIdFromRoute=b.current.params.videoId,a.getVideo=function(){return a.videoIdFromRoute?c.one(a.videoIdFromRoute).get().then(a.setVideo,function(a){console.log(a)}):(a.video={},g.restangularizeElement(null,a.video,"videos"),a.setVideo(a.video),void 0)},a.setVideo=function(b){_.isEmpty(b.input)&&(b.input=""),a.video=b,_.isUndefined(a.video.tags)&&(a.video.tags=[]),a.data.tagObjects=a.video.tags,a.video.tags=_.pluck(a.video.tags,"id"),_.isUndefined(b.channel)||f.setChannel(b.channel),_.isUndefined(b.series)||f.setSeries(b.series),_.isUndefined(b.sponsor)||(a.data.sponsor=b.sponsor),_.isUndefined(b.published)||(a.published=b.published)},a.save=function(){a.videoDetailForm.$valid?(a.video.channel=_.has(f.data.channel,"id")?f.data.channel.id:null,a.video.series=_.has(f.data.series,"id")?f.data.series.id:null,a.video.season=_.has(f.data.season,"id")?f.data.season.id:null,a.video.sponsor=_.has(a.data.sponsor,"id")?a.data.sponsor.id:null,a.video.tags=_.pluck(a.data.tagObjects,"id"),a.video.save().then(a.successCallback,a.displaySomethingWentWrongAlert)):i.error(h.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},a.displaySomethingWentWrongAlert=function(){i.error(h.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)},a.successCallback=function(c){a.videoDetailForm.$setPristine(),e.displaySavingAnimation().then(function(){_.has(b.current.params,"videoId")||d.path("cms/videos/"+c.id+"/")})},a["delete"]=function(){a.video.remove().then(function(){i.success(h.DELETE_SUCCESSFUL,!0).then(function(){d.path("cms/")})})},a.dateTimeSelectorCallback=function(b){a.video.published=b,a.save()},a.$on("$destroy",function(){f.clear(),a.data.sponsor=null,a.video.sponsor=null}),a.getVideo()}]),angular.module("videoHub").constant("VideoFieldConstants",{FILE_TOO_LARGE_ERROR_MESSAGE:"Upload file cannot be larger than 1024MB.",MUST_UPLOAD_FILES_ERROR_MESSAGE:"You must upload a video file.",PLEASE_SELECT_A_FILE_ERROR_MESSAGE:"Please select a file.",UPLOAD_COMPLETE_SUCCESS_MESSAGE:"Upload Complete"}).directive("videoField",["Zencoder","$q",function(a,b){return{templateUrl:"components/detail-pages/videodetail/videofield/videofield.html",transclude:!0,controller:["$scope","$timeout","VideoFieldConstants","VideoService","AlertService",function(c,d,e,f,g){c.uploadVideo=function(){var b=$("#"+c.video.id+"-file-field");b.unbind("change"),b.bind("change",function(b){var d=b.target.files[0];c.validateVideoFile(d).then(c.addVideo).then(a.uploadToS3AndEncode).then(function(){c.encodingProgress=100,c.fetchNewVideoObject()},function(a){g.error(a,!0)},function(a){_.isUndefined(a)||(a.loaded?c.uploadProgress=Math.round(a.loaded/a.total*100):a.progress&&(c.encodingProgress=Math.round(a.progress)||0))})}),b.click()},c.validateVideoFile=function(a){var c=b.defer();return a?a.size>1073741824?c.reject(e.FILE_TOO_LARGE_ERROR_MESSAGE):0!==a.type.indexOf("video/")?c.reject(e.MUST_UPLOAD_FILES_ERROR_MESSAGE):c.resolve(a):c.reject(e.PLEASE_SELECT_A_FILE_ERROR_MESSAGE),c.promise},c.addVideo=function(a){var d=b.defer();return c.video.doGET("encoding_auth").then(function(b){c.video.encoding_payload=b;var e={file:a,videoObject:c.video};d.resolve(e)}),d.promise},c.checkIfSourcesHaveLoadedAndRetryIfTheyAreNot=function(a){_.isEmpty(a.sources)?d(c.fetchNewVideoObject,2e3):c.video=a},c.fetchNewVideoObject=function(){f.one(c.video.id).get().then(c.checkIfSourcesHaveLoadedAndRetryIfTheyAreNot)}}]}}]),angular.module("videoHub").constant("ZencoderConstants",{UPLOAD_TO_S3_PROGRESS_MESSAGE:"Uploading X% complete",UPLOAD_TO_S3_UPLOAD_BEGINNING_MESSAGE:"Uploading...",UPLOAD_TO_S3_UPLOAD_COMPLETE_MESSAGE:"Upload Complete. Begin Encoding.",UPLOAD_TO_S3_UPLOAD_FAILED_MESSAGE:"Upload Failed",ENCODE_FAILED_MESSAGE:"Encoding has failed.",ENCODE_PROGRESS_MESSAGE:"Encoding: X%"}).service("Zencoder",["$http","$q","$interval","ZencoderConstants",function a(b,c,d,e){var a=this;this.uploadToS3AndEncode=function(b){var d=c.defer(),e=b.file,f=b.videoObject,g=function(a){d.resolve(a)},h=function(a){d.reject(a)},i=function(a){d.notify(a)};return a.uploadToS3(e,f).then(a.encode,h,i).then(g,h,i),d.promise},this.uploadToS3=function(a,b){var d=b.encoding_payload,f=c.defer(),g=new FormData;g.append("key",d.key),g.append("AWSAccessKeyId",d.AWSAccessKeyId),g.append("acl",d.acl),g.append("success_action_status",d.success_action_status),g.append("policy",d.policy),g.append("signature",d.signature),g.append("file",a);var h=new XMLHttpRequest;return h.open("POST",d.upload_endpoint),h.upload.onprogress=function(a){f.notify(a)},h.onload=function(){f.resolve(b)},h.addEventListener("error",function(){f.reject(e.UPLOAD_TO_S3_UPLOAD_FAILED_MESSAGE)}),h.send(g),f.promise},this.encode=function(b){var e=c.defer();return b.doPOST({},"encode").then(function(c){var f=c.json;a.progressInterval=d(a.encodingProgressCallback.bind(a,b,f,e),2e3)},function(a){e.reject(a)}),e.promise},this.encodingProgressCallback=function(c,f,g){return b({url:f,method:"GET",ignoreAuthorizationHeader:!0}).then(function(b){"finished"===b.data.state?(g.resolve(c),d.cancel(a.progressInterval)):"failed"===b.data.state?(g.reject(e.ENCODE_FAILED_MESSAGE),d.cancel(a.progressInterval)):_.isUndefined(b.data.progress)||g.notify(b.data)})}}]),angular.module("videoHub").controller("ChannelListController",["$scope","$location","ListService",function(a,b,c){c.setService("ChannelService"),a.update=function(){a.list=c.data.list,a.totalItems=c.data.totalItems,a.params=c.getParams()},c.updateList().then(a.update),a.changeToEditPage=function(a){b.path("cms/channels/"+a+"/")},a.setOrderAndUpdateList=function(b){c.setOrder(b),c.updateList().then(a.update)},a.selectSearchBox=function(){$("#searchBox").focus()},a.pageChanged=function(b){c.setPage(b),c.updateList().then(a.update)},a.updateCallback=function(){c.updateList().then(a.update)},a.$on("$destroy",function(){c.clearQueryParams()}),a.service=c.service}]),angular.module("videoHub").controller("SeriesListController",["$scope","$location","ListService",function(a,b,c){c.setService("SeriesService"),a.update=function(){a.list=c.data.list,a.totalItems=c.data.totalItems,a.params=c.getParams()},c.updateList().then(a.update),a.changeToEditPage=function(a){b.path("cms/series/"+a+"/")},a.setOrderAndUpdateList=function(b){c.setOrder(b),c.updateList().then(a.update)},a.clearSearchAndUpdateList=function(){c.clearSearch(),c.updateList().then(a.update)},a.selectSearchBox=function(){$("#searchBox").focus()},a.pageChanged=function(b){c.setPage(b),c.updateList().then(a.update)},a.setSearchAndUpdateList=function(){c.setSearch(a.params.q),c.updateList().then(a.update)},a["new"]=function(){b.path("cms/new/")},a.updateCallback=function(){c.updateList().then(a.update)},a.$on("$destroy",function(){c.clearQueryParams()}),a.service=c.service}]),angular.module("videoHub").controller("SponsorListController",["$scope","$location","ListService",function(a,b,c){c.setService("SponsorService"),a.update=function(){a.list=c.data.list,a.totalItems=c.data.totalItems,a.params=c.getParams()},c.updateList().then(a.update),a.changeToEditPage=function(a){b.path("cms/sponsors/"+a+"/")},a.setOrderAndUpdateList=function(b){c.setOrder(b),c.updateList().then(a.update)},a.clearSearchAndUpdateList=function(){c.clearSearch(),c.updateList().then(a.update)},a.selectSearchBox=function(){$("#searchBox").focus()},a.pageChanged=function(b){c.setPage(b),c.updateList().then(a.update)},a.setSearchAndUpdateList=function(){c.setSearch(a.params.q),c.updateList().then(a.update)},a["new"]=function(){b.path("cms/new/")},a.updateCallback=function(){c.updateList().then(a.update)},a.$on("$destroy",function(){c.clearQueryParams()}),a.service=c.service}]),angular.module("videoHub").controller("VideoListController",["$scope","$location","ListService",function(a,b,c){c.setService("VideoService"),a.update=function(){a.list=c.data.list,a.totalItems=c.data.totalItems,a.params=c.getParams()},c.updateList().then(a.update),a.changeToEditPage=function(a){b.path("cms/videos/"+a+"/")},a.setOrderAndUpdateList=function(b){c.setOrder(b),c.updateList().then(a.update)},a.clearSearchAndUpdateList=function(){c.clearSearch(),c.updateList().then(a.update)},a.selectSearchBox=function(){$("#searchBox").focus()},a.pageChanged=function(b){c.setPage(b),c.updateList().then(a.update)},a.setSearchAndUpdateList=function(){c.setSearch(a.params.q),c.updateList().then(a.update)},a["new"]=function(){b.path("cms/new/")},a.updateCallback=function(){c.updateList().then(a.update)},a.$on("$destroy",function(){c.clearQueryParams()}),a.service=c.service}]),angular.module("videoHub").controller("LoginController",["$scope","authService","LOGO_URL","AlertService",function(a,b,c,d){a.init=function(){a.username="",a.password="",a.submitted="",a.LOGO_URL=c},a.submitLogin=function(){a.submitted="submitted",d.clear(),_.isEmpty(a.username)||_.isEmpty(a.password)||b.login(a.username,a.password)},a.init()}]),angular.module("videoHub").directive("alertbar",function(){return{templateUrl:"shared/alert/alert-directive.html",restrict:"E",controller:["$scope","AlertService",function(a,b){a.alertStatus=b.alertStatus}]}}),angular.module("videoHub").constant("AlertServiceConstants",{TIME_TO_WAIT_BEFORE_CLEARING:2e3}).service("AlertService",["$timeout","$q","AlertServiceConstants",function(a,b,c){this.alertStatus={},this.clear=function(d){_.isUndefined(d)&&this.setAlertStatusElementsToFalse();var e=b.defer(),f=this;return d?a(function(){f.setAlertStatusElementsToFalse(),e.resolve()},c.TIME_TO_WAIT_BEFORE_CLEARING):e.resolve(),e.promise},this.setAlertStatusElementsToFalse=function(){this.alertStatus.error=!1,this.alertStatus.info=!1,this.alertStatus.success=!1},this.success=function(a,b){return this.clear(),this.alertStatus.success=a,this.clear(b)},this.error=function(a,b){return this.clear(),this.alertStatus.error=a,this.clear(b)},this.info=function(a,b){return this.clear(),this.alertStatus.info=a,this.clear(b)}}]),angular.module("videoHub").factory("ChannelService",["SearchableService",function(a){return new a("channels").service}]),angular.module("videoHub").config(["RestangularProvider",function(a){a.setBaseUrl("/api/v0/"),a.addResponseInterceptor(function(a,b,c){if("getList"===b||"search"===c){var d=a.results;return d&&(d.meta={counts:a.counts,prev:a.prev,next:a.next,facets:a.facets}),d}return a});var b=function(a){_.has(a,"published")&&a.published&&(a.published=moment(a.published))};a.addResponseInterceptor(function(a){return _.isArray(a)?_.each(a,b):b(a),a});var c=function(a){_.has(a,"published")&&moment.isMoment(a.published)&&(a.published=a.published.format())};a.addRequestInterceptor(function(a){return c(a),a})}]),angular.module("videoHub").factory("SearchableService",["Restangular",function(a){var b=function(b){if(_.isUndefined(b))throw"Service Name is required";this.service=a.service(b),this.service.search=a.service("search",a.all(b)),this.service.type=b};return b}]),angular.module("videoHub").factory("SeasonService",["Restangular",function(a){return a.service("seasons")}]),angular.module("videoHub").factory("SeriesService",["SearchableService",function(a){return new a("series").service}]),angular.module("videoHub").factory("SlidesService",["Restangular",function(a){return a.service("slides")}]),angular.module("videoHub").factory("SponsorService",["SearchableService",function(a){return new a("sponsors").service}]),angular.module("videoHub").factory("TagsService",["Restangular",function(a){return a.service("tags")}]),angular.module("videoHub").factory("VideoService",["SearchableService",function(a){return new a("videos").service}]),angular.module("videoHub").factory("authInterceptor",["$rootScope","$q","$location","$injector","httpRequestBuffer","localStorageService",function(a,b,c,d,e,f){return{request:function(a){a.headers=a.headers||{};var b=f.get("authToken"),c=_.has(a.headers,"X-Betty-Api-Key");return b&&(a.ignoreAuthorizationHeader||c||(a.headers.Authorization="JWT "+b)),a},responseError:function(a){if(a.config){var c=a.config.ignoreAuthModule||a.config.headers.ignoreAuthModule;if(!c&&(403===a.status||401===a.status)){var f=b.defer();e.append(a.config,f);var g=d.get("authService");g.refreshToken()}}return b.reject(a)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]).service("authService",["$http","$rootScope","$location","httpRequestBuffer","localStorageService","AlertService","CurrentUser",function(a,b,c,d,e,f,g){var h=function(b,d){return a.post("/api/token/auth",{username:b,password:d}).success(function(a){e.set("authToken",a.token),g.setCurrentUser(b),c.path("cms/")}).error(function(){f.error("Username or password provided is incorrect.",!1)})},i=function(){var b=e.get("authToken");return a.post("/api/token/refresh",{token:b},{ignoreAuthModule:!0}).success(function(a){e.set("authToken",a.token),d.retryAll()}).error(function(){d.rejectAll(),f.error("You failed to authenticate. Redirecting to login.",!1),c.path("cms/login")})};return{login:h,refreshToken:i}}]).factory("httpRequestBuffer",["$injector",function(a){function b(b,d){function e(a){d.resolve(a)}function f(a){d.reject(a)}c=c||a.get("$http"),b.headers.ignoreAuthModule=!0,c(b).then(e,f)}var c,d=[];return{append:function(a,b){d.push({config:a,deferred:b})},rejectAll:function(a){a&&_.each(d,function(b){b.deferred.reject(a)}),d=[]},retryAll:function(){_.each(d,function(a){b(a.config,a.deferred)}),d=[]}}}]),function(){function a(a,b,c,d,e,f){function g(){var b=c.defer();angular.element(k).remove();var g=angular.element(l);return angular.element("body").append(g),g.click(),g.unbind("change"),g.bind("change",function(c){1!==c.target.files.length&&b.reject("We need exactly one image!");var g=c.target.files[0];0!==g.type.indexOf("image/")&&b.reject("Not an image!"),g.size>10485760&&b.reject("The file is too large!");var h=new FormData;h.append("image",g),a({method:"POST",url:d+"/api/new",headers:{"X-Betty-Api-Key":e,"Content-Type":void 0,"X-CSRFToken":void 0},data:h,transformRequest:angular.identity,transformResponse:function(a){"string"==typeof a&&(a=$.parseJSON(a));var b=new f(a);return b}}).success(function(a){b.resolve(a)}).error(function(a){b.reject(a)})}),b.promise}function h(b){return a({method:"GET",url:d+"/api/"+b,headers:{"X-Betty-Api-Key":e,"Content-Type":void 0,"X-CSRFToken":void 0},transformRequest:angular.identity,transformResponse:function(a){return"string"==typeof a&&(a=$.parseJSON(a)),new f(a)}})}function i(b,c,g,h){return a({method:"PATCH",url:d+"/api/"+b,headers:{"X-Betty-Api-Key":e,"Content-Type":void 0,"X-CSRFToken":void 0},data:{name:c,credit:g,selections:h},transformRequest:angular.identity,transformResponse:function(a){return"string"==typeof a&&(a=$.parseJSON(a)),new f(a)}})}function j(b,c,f){return a({method:"POST",url:d+"/api/"+b+"/"+c,headers:{"X-Betty-Api-Key":e,"Content-Type":void 0,"X-CSRFToken":void 0},data:f})}var k="#bulbs-cms-hidden-image-file-input",l='<input id="bulbs-cms-hidden-image-file-input" type="file" accept="image/*" style="position: absolute; left:-99999px;" name="image" />';this.upload=g,this.get=h,this.detail=h,this.detailPatch=i,this.updateSelection=j}function b(a,b,c,d,e,f){function g(a){this.id=a.id,this.name=a.name,this.width=a.width,this.height=a.height,this.selections={};for(var b in a.selections)this.selections[b]=new f(a.selections[b])}return g.prototype.scaleToFit=function(a,b){var c;if(a&&b){var d=a/b,e=this.width/this.height;c=d>e?b/this.height:a/this.width}else a&&(c=a/this.width),b&&(c=b/this.height);var f={width:Math.round(this.width*c),height:Math.round(this.height*c),scale:c};return f},g.prototype.getStyles=function(a,b,c){0===b&&(b=null);var d=this.selections[c],f=d.scaleToFit(a,b);return{"background-image":"url("+this.url("original",e,"jpg")+")","background-size":Math.floor(f.width()/d.width()*this.width)+"px","background-position":"-"+f.x0+"px -"+f.y0+"px",height:f.height()+"px",width:f.width()+"px","background-repeat":"no-repeat",position:"relative"}},g.prototype.url=function(b,d,e){for(var f=a("{{ base_url }}/{{ id }}/{{ ratio }}/{{ width }}.{{ format }}"),g=this.id.toString(),h="",i=0;i<g.length;i++)i%4===0&&0!==i&&(h+="/"),h+=g.substr(i,1);return f({base_url:c,id:h,ratio:b,width:d,format:e})},g.prototype.updateSelection=function(a,e){var g={x0:e.x0,x1:e.x1,y0:e.y0,y1:e.y1};return e.source&&(g.source=e.source),b({method:"POST",url:c+"/api/"+this.id+"/"+a,headers:{"X-Betty-Api-Key":d,"Content-Type":void 0,"X-CSRFToken":void 0},data:g,transformResponse:function(b){return"string"==typeof b&&(b=$.parseJSON(b)),[a,new f(b.selections[a])]}})},g}function c(){function a(a){this.x0=a.x0,this.x1=a.x1,this.y0=a.y0,this.y1=a.y1,this.source=a.source}return a.prototype.width=function(){return this.x1-this.x0},a.prototype.height=function(){return this.y1-this.y0},a.prototype.scaleBy=function(b){var c=new a({x0:Math.round(this.x0*b),x1:Math.round(this.x1*b),y0:Math.round(this.y0*b),y1:Math.round(this.y1*b)});return c},a.prototype.scaleToFit=function(a,b){var c;if(a&&b){var d=a/b,e=this.width()/this.height();c=d>e?b/this.height():a/this.width()}else a&&(c=a/this.width()),b&&(c=b/this.height());return this.scaleBy(c)},a}angular.module("BettyCropper",["restangular"]).value("DEFAULT_IMAGE_WIDTH",1200).factory("Selection",c).factory("BettyImage",b).service("BettyCropper",a),a.$inject=["$http","$interpolate","$q","IMAGE_SERVER_URL","BC_API_KEY","BettyImage"],b.$inject=["$interpolate","$http","IMAGE_SERVER_URL","BC_API_KEY","DEFAULT_IMAGE_WIDTH","Selection"]}(),angular.module("videoHub").directive("bettyeditable",["$http","BettyCropper","openImageCropModal",function(a,b,c){return{restrict:"E",templateUrl:"shared/bettycropper/bettyeditable.html",scope:{image:"=",addStyles:"@",placeholderText:"@",hideMetas:"=",ratio:"@",editable:"=?",imageChangeCallback:"="},controller:["$scope",function(a){a.editable=angular.isDefined(a.editable)?a.editable:!0,a.callImageChangeCallback=function(b){_.isFunction(a.imageChangeCallback)&&a.imageChangeCallback(b)},a.upload=function(){b.upload().then(function(b){a.image={id:b.id,caption:null,alt:null},a.bettyImage=b,a.callImageChangeCallback(b)},function(a){console.log(a)},function(a){console.log(a)})},a.edit=function(){c(a.image).then(function(c){null===c.id?a.image=null:(a.image=c,b.get(a.image.id).then(function(b){a.bettyImage=b.data,a.setStyles()})),a.callImageChangeCallback()})}}],link:function(a,d){void 0===a.bettyImage&&(a.bettyImage=null),a.setStyles=function(){if(a.bettyImage)a.imageStyling=a.bettyImage.getStyles(d.parent().width(),d.parent().height(),a.ratio);else{var b=parseInt(a.ratio.split("x")[0],10),c=parseInt(a.ratio.split("x")[1],10);a.imageStyling={"background-color":"#333",position:"relative",width:d.parent().width(),height:Math.floor(d.parent().width()*c/b)+"px"}}},a.$watch("image",function(c){c&&c.id&&b.get(c.id).then(function(b){a.bettyImage=b.data})}),a.$watch("bettyImage",function(){a.setStyles()},!0),d.resize(a.setStyles),a.removeImage=function(){a.image.id=null,a.callImageChangeCallback()},a.editImage=function(){c(a.image).then(function(a){console.log(a)})}}}}]),angular.module("BettyCropper").controller("ImageCropModalCtrl",["$scope","$timeout","$modalInstance","BettyCropper","Selection","DEFAULT_IMAGE_WIDTH","imageData","ratios",function(a,b,c,d,e,f,g,h){a.selectedCrop=null,a.cropMode=!1,a.ratios=h,a.finished=!1,a.thumb_container_styles={},a.imageData=g,a.image||(a.image=null,d.get(g.id).then(function(b){a.image=b.data})),a.$watch("image",function(b){if(b){var c=!0;for(var d in b.selections)if("auto"===b.selections[d].source){c=!1;break}a.finished=c,a.scaleData=b.scaleToFit(550,400),$(".crop-image-container img").one("load",function(){$(this).Jcrop({allowSelect:!1,allowMove:!0,allowResize:!0,keySupport:!1},function(){a.jcrop_api=this})}),a.image_url=b.url("original",f,"jpg"),a.ratios||(a.ratios=Object.keys(b.selections)),a.setThumbStyles()}}),a.$watch("selectedCrop",function(b){if(a.image){var c=!0;for(var d in a.image.selections)if("auto"===a.image.selections[d].source&&d!==b){c=!1;break}a.finished=c}}),a.selectCrop=function(b){if(!b){b=Object.keys(a.image.selections)[0];for(var c in a.image.selections)if("auto"===a.image.selections[c].source){b=c;break}}var d=a.image.selections[b].scaleBy(a.scaleData.scale);a.jcrop_api.setOptions({aspectRatio:d.width()/d.height()}),a.jcrop_api.setSelect([d.x0,d.y0,d.x1,d.y1]),a.cropMode=!0,a.selectedCrop=b},a.setThumbStyles=function(){a.thumb_styles=a.thumb_styles||{};for(var b in a.image.selections){var c=a.image.selections[b].scaleToFit(170,170);a.thumb_container_styles[b]={"padding-top":Math.round((180-c.height())/2)+"px","padding-bottom":"5px","padding-left":Math.round((180-c.width())/2)+"px","padding-right":"5px"},a.thumb_styles[b]=a.image.getStyles(170,170,b)}},a.save=function(b){var c=a.jcrop_api.tellSelect(),d=new e({x0:c.x,x1:c.x2,y0:c.y,y1:c.y2,source:"user"});return d=d.scaleBy(1/a.scaleData.scale),d.x1>a.image.width&&(d.x1=a.image.width),d.y1>a.image.height&&(d.y1=a.image.height),this.image.updateSelection(b,d)},a.saveAndQuit=function(){var b=a.selectedCrop;this.save(b).then(function(b){var c=b.data[0],d=b.data[1];a.image.selections[c]=d}),a.cropMode=!1,c.close(g)},a.saveAndNext=function(){var b=a.selectedCrop;this.save(b).then(function(b){var c=b.data[0],d=b.data[1];a.image.selections[c]=d;var e=(a.ratios.indexOf(c)+1)%a.ratios.length;a.selectCrop(a.ratios[e])})}}]),angular.module("BettyCropper").factory("openImageCropModal",["$modal",function(a){var b=function(b,c){return a.open({templateUrl:"shared/bettycropper/image-crop-modal.html",controller:"ImageCropModalCtrl",resolve:{imageData:function(){return b},ratios:function(){return c||!1
}},backdrop:"static"}).result};return b}]),angular.module("videoHub").filter("convertToLocal",function(){return function(a){return a?moment.utc(a).local().format("L @ hh:mm"):a}}),angular.module("videoHub").directive("createContent",function(){return{restrict:"E",templateUrl:"shared/create-content/create-content.html",controller:["$scope","$location",function(a,b){a.setContentType=function(b){a.contentType=b},a.goToContentTypesCreationPage=function(){b.path("cms/"+a.contentType+"/new/")}}]}}),angular.module("videoHub").service("CurrentUser",["localStorageService","$location",function(a,b){this.currentUser=null,this.getCurrentUser=function(){return a.get("currentUser")},this.setCurrentUser=function(b){a.set("currentUser",b)},this.logout=function(){this.currentUser=null,a.remove("authToken"),a.remove("currentUser"),b.path("cms/login/")}}]),angular.module("videoHub").directive("dateTimeSelector",["$modal",function(a){return{link:function(b,c){var d=null;c.addClass("datetime-selection-modal-opener"),c.on("click",function(){d=a.open({templateUrl:"shared/date-time-selector/date-time-selector-modal.html",controller:"DateTimeSelectorModalController",scope:b}),d.result.then(function(a){b.modDateTime=a,b.dateTimeSelectorModalOnClose&&b.dateTimeSelectorModalOnClose(a)})})},restrict:"A",require:"^ngModel",scope:{modDateTime:"=ngModel",dateTimeSelectorModalTitle:"@",dateTimeSelectorModalOnClose:"="}}}]),angular.module("videoHub").filter("dateTimeSelectorFormatter",function(){return function(a){return a?moment(a).format("L @ hh:mm"):a}}),angular.module("videoHub").controller("DateTimeSelectorModalController",["moment","$scope","$modalInstance","TIMEZONE_NAME",function(a,b,c,d){var e=function(){return a.tz(d)};b.setDate=function(c){b.tempDateTime=a(c)},b.setDateToday=function(){var c=e();b.tempDateTime=a().year(c.year()).month(c.month()).date(c.date())},b.setDateTomorrow=function(){var c=e();b.tempDateTime=a().year(c.year()).month(c.month()).date(c.date()+1)},b.setTimeNow=function(){b.tempDateTime=e()},b.setTimeMidnight=function(){b.tempDateTime=e().hour(24).minute(0)},b.clearDateTime=function(){var a=window.confirm("Are you sure you wish to unpublish this?");a&&c.close(null)},b.chooseDateTime=function(){if(b.dateValid){var d=a(b.tempDateTime);c.close(d)}else console.error("Attempting to choose invalid date.")},b.tempDateTime=angular.copy(b.modDateTime),b.TIMEZONE_LABEL=a.tz(d).format("z"),b.tempDateTime||b.setTimeNow(),b.dateValid=!1,b.$watch("tempDateTime",function(){b.dateValid=!_.isNull(b.tempDateTime)&&a(b.tempDateTime).isValid()})}]),angular.module("videoHub").controller("DeleteModalController",["$scope","$modalInstance",function(a,b){a.close=function(){b.close(!0)}}]),angular.module("videoHub").directive("deleteModal",["$modal",function(a){return{controller:["$scope",function(a){a.modalHideDeleteButton=angular.isDefined(a.modalHideDeleteButton)?a.modalHideDeleteButton:!1}],link:function(b,c){var d=null;c.addClass("delete-modal-opener"),c.on("click",function(){d=a.open({templateUrl:"shared/delete-modal/delete-modal.html",controller:"DeleteModalController",scope:b}),d.result.then(function(a){a&&b.confirmCallback()})})},restrict:"A",scope:{confirmCallback:"=",modalHideDeleteButton:"=?",modalText:"@"}}}]),angular.module("videoHub").directive("detailsNavBar",["$document",function(a){return{restrict:"E",templateUrl:"shared/detailsnavbar/detailsnavbar.html",transclude:!0,scope:{deleteCallback:"=",deleteModalText:"@",deleteModalHideDelete:"=?",sponsor:"=",hideDeleteButton:"=",hideSponsorButton:"=",hidePublishButton:"=",save:"=saveFunction",published:"=",toolsDropdownText:"=",sponsorSelectionModalOnClose:"&",dateTimeSelectorModalOnClose:"=",isDirty:"="},controller:["$scope","$rootScope","$location","CurrentUser","TIMEZONE_NAME","SaveButtonStateService","LOGO_URL",function(b,c,d,e,f,g,h){b.LOGO_URL=h,b.currentUserName=e.getCurrentUser(),b.TIMEZONE_LABEL=moment.tz(f).format("z"),b.data={},b.data=g.data,b.saveHotkey=function(a){return 83===a.keyCode&&(a.metaKey||a.ctrlKey)?(b.save(),a.preventDefault(),b.$$phase||b.$apply(),!1):void 0},b.saveKeyUnbind=a.bind("keydown",b.saveHotkey),b.$on("$destroy",function(){a.unbind("keydown",b.saveHotkey)}),b.$on("$locationChangeStart",function(a){if(b.isDirty){var c=confirm("Are you sure you want to leave this page? You have unsaved changes that could be lost.");c||a.preventDefault()}})}]}}]),angular.module("videoHub").constant("SAVE_BUTTON_STATES",{SAVING:"saving",SAVED:"saved"}).service("SaveButtonStateService",["$timeout","$q","SAVE_BUTTON_STATES",function(a,b,c){this.data={},this.data.saveButtonState="";var d=this,e=function(){d.data.saveButtonState=c.SAVING},f=function(){d.data.saveButtonState=c.SAVED},g=function(){d.data.saveButtonState=""};this.displaySavingAnimation=function(){var c=b.defer();return e(),a(f,2e3).then(function(){a(g,1e3).then(function(){c.resolve()})}),c.promise}}]),angular.module("videoHub").directive("dropdownSelector",["$injector",function(a){return{templateUrl:"shared/dropdownselector/dropdownselector.html",scope:{ngModel:"=",ngRequired:"@",service:"@",placeholderText:"@",keyToSortItemsBy:"@"},controller:["$scope",function(b){var c=a.get(b.service);b.populateCurrentItemsList=function(){c.getList({page_size:100}).then(function(a){b.currentItems=a})},b.keyToSortItemsBy||(b.keyToSortItemsBy="name"),b.populateCurrentItemsList()}]}}]),angular.module("videoHub").directive("filterButtons",["ListService",function(a){return{controller:["$scope",function(b){b.params=a.getParams(),b.setFilterAndUpdateList=function(c){return a.setFilter(c),b.params=a.getParams(),a.updateList().then(function(){b.updateCallback&&b.updateCallback()})}}],restrict:"E",scope:{updateCallback:"&"},templateUrl:"shared/filter-buttons/filter-buttons.html"}}]),angular.module("videoHub").service("FilterService",function(){var a=this;a.filters=[],a.addFilter=function(b,c){a.filters.push(a.createFilter(b,c))},a.removeFilter=function(b,c){if(_.isString(b)){var d=b,e=a.createFilter(d,c);a.filters=_.reject(a.filters,a.doFiltersMatch,e)}else{var f=b;a.filters=_.reject(a.filters,f)}},a.createFilter=function(a,b){return{name:a,type:b}},a.clearFilters=function(){a.filters=[]},a.getFilters=function(){return a.filters},a.doFiltersMatch=function(a){return this.name===a.name&&this.type===a.type},a.getFiltersArrayFormattedForBackend=function(){var b={};return _.forEach(a.getFilters(),function(a){this[a.type]=a.name},b),b}}),angular.module("videoHub").directive("listPageColumn",function(){return{templateUrl:"shared/list-page-column/list-page-column.html",replace:!0,restrict:"A",scope:{length:"@",text:"@",columnWidth:"@"},link:function(a){a.text.length>a.length?(a.truncatedText=_.trunc(a.text,a.length),a.tooltipText=a.text,a.displayText=a.truncatedText,a.tooltipTrigger=null):(a.tooltipTrigger="hover",a.displayText=a.text)}}}),angular.module("videoHub").directive("listNavBar",function(){return{restrict:"E",templateUrl:"shared/listnavbar/listnavbar.html",scope:{activeNavbarTab:"@"},controller:["$scope","$rootScope","$location","CurrentUser","LOGO_URL",function(a,b,c,d,e){a.LOGO_URL=e,a.currentUserName=d.getCurrentUser(),a.logout=function(){d.logout()}}]}}),angular.module("videoHub").service("ListService",["$location","$injector","FilterService",function(a,b,c){this.data={};var d=this;this.service=null;var e=null;this.getParams=function(){return this.data.params},this.setService=function(a){this.service=b.get(a),e=this.service,this.setParamsFromQueryParams(),this.data.list=[],this.data.totalItems=0},this.setParamsFromQueryParams=function(){var b=a.search();this.data.params={},this.data.params.filters={},this.data.params.sort={},b.sort&&(this.data.params.sort[b.sort]=b.order),b.filter&&this.setFilter(b.filter)},this.setFilter=function(a){_.isNull(a)?this.data.params.filters=_.omit(this.data.params.filters,"status"):this.data.params.filters.status=a},this.setOrder=function(a){var b=this.data.params.sort||{},c=_.has(b,a),d="asc"===b[a];b={},c&&!d?b[a]="asc":c&&d||(b[a]="desc"),this.data.params.sort=b},this.setPage=function(a){this.data.params.page=a,this.data.params.size=d.data.pageSize},this.updateList=function(){return this.setFilters(),this.updateQueryParams(),e.search.post(this.data.params).then(d.setList)},this.setFilters=function(){var a=this.data.params.filters.status;this.data.params.filters=c.getFiltersArrayFormattedForBackend(),this.data.params.filters.status=a},this.setList=function(a){d.data.list=a,a.meta?(d.data.totalItems=a.meta.counts.total,d.data.pageSize=a.meta.counts.results):(a.meta={},a.meta.count=0)},this.clearQueryParams=function(){d.data.params={},c.clearFilters(),a.search(this.data.params)},this.updateQueryParams=function(){var b={};_.chain(this.data.params.sort).keys().isEmpty().value()||(b.order=this.getOrder(),b.sort=this.getSortType()),_.isUndefined(this.data.params.filters)||(b.filter=this.getStatusFilter()),a.search(b)},this.getOrder=function(){return _.chain(this.data.params.sort).keys().first().value()},this.getSortType=function(){return _.chain(this.data.params.sort).values().first().value()},this.getStatusFilter=function(){return this.data.params.filters.status}}]),angular.module("videoHub").directive("navDropdown",[function(){return{controller:["$scope",function(a){a.sections=[{href:"cms/",title:"Videos"},{href:"cms/series/",title:"Series"},{href:"cms/channels/",title:"Channels"},{href:"cms/sponsors/",title:"Sponsors"}],a.sections=_.sortBy(a.sections,function(a){return a.title})}],restrict:"E",scope:{active:"@"},templateUrl:"shared/nav-dropdown/nav-dropdown.html"}}]),function(){var a,b="videoHub",c="__default";try{a=angular.module(b)}catch(d){a=angular.module(b,[])}a.directive("dirPaginate",["$compile","$parse","$timeout","paginationService",function(a,b,d,e){return{terminal:!0,multiElement:!0,priority:5e3,compile:function(d,f){var g=f.dirPaginate,h=g.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),i=/\|\s*itemsPerPage\s*:[^|]*/;if(null===h[2].match(i))throw"pagination directive: the 'itemsPerPage' filter must be set.";var j=h[2].replace(i,""),k=b(j),l=f.paginationId||c;return e.registerInstance(l),function(d,f,h){var i=b(h.paginationId)(d)||h.paginationId||c;e.registerInstance(i);var j,l=!!g.match(/(\|\s*itemsPerPage\s*:[^|]*:[^|]*)/);j=i===c||l?g:g.replace(/(\|\s*itemsPerPage\s*:[^|]*)/,"$1 : '"+i+"'"),f[0].hasAttribute("dir-paginate-start")||f[0].hasAttribute("data-dir-paginate-start")?(h.$set("ngRepeatStart",j),f.eq(f.length-1).attr("ng-repeat-end",!0)):h.$set("ngRepeat",j);var m,n=a(f,!1,5e3);if(h.currentPage)m=b(h.currentPage);else{var o=i+"__currentPage";d[o]=1,m=b(o)}e.setCurrentPageParser(i,m,d),"undefined"!=typeof h.totalItems?(e.setAsyncModeTrue(i),d.$watch(function(){return b(h.totalItems)(d)},function(a){a>=0&&e.setCollectionLength(i,a)})):d.$watchCollection(function(){return k(d)},function(a){a&&e.setCollectionLength(i,a.length)}),n(d)}}}}]),a.directive("dirPaginationControls",["paginationService","paginationTemplate",function(a,b){function d(a,b,c,d){var f,g=[],h=Math.ceil(b/c),i=Math.ceil(d/2);f=i>=a?"start":a>h-i?"end":"middle";for(var j=h>d,k=1;h>=k&&d>=k;){var l=e(k,a,d,h),m=2===k&&("middle"===f||"end"===f),n=k===d-1&&("middle"===f||"start"===f);g.push(j&&(m||n)?"...":l),k++}return g}function e(a,b,c,d){var e=Math.ceil(c/2);return a===c?d:1===a?a:d>c?b>d-e?d-c+a:b>e?b-e+a:a:a}var f=/^\d+$/;return{restrict:"AE",templateUrl:function(a,c){return c.templateUrl||b.getPath()},scope:{maxSize:"=?",onPageChange:"&?",paginationId:"=?"},link:function(b,e,g){function h(c){k(c)&&(b.pages=d(c,a.getCollectionLength(m),a.getItemsPerPage(m),o),b.pagination.current=c,j(),b.onPageChange&&b.onPageChange({newPageNumber:c}))}function i(){var c=parseInt(a.getCurrentPage(m))||1;b.pages=d(c,a.getCollectionLength(m),a.getItemsPerPage(m),o),b.pagination.current=c,b.pagination.last=b.pages[b.pages.length-1],b.pagination.last<b.pagination.current?b.setCurrent(b.pagination.last):j()}function j(){var c=a.getCurrentPage(m),d=a.getItemsPerPage(m),e=a.getCollectionLength(m);b.range.lower=(c-1)*d+1,b.range.upper=Math.min(c*d,e),b.range.total=e}function k(a){return f.test(a)&&a>0&&a<=b.pagination.last}var l=g.paginationId||c,m=b.paginationId||g.paginationId||c;if(!a.isRegistered(m)&&!a.isRegistered(l)){var n=m!==c?" (id: "+m+") ":" ";throw"pagination directive: the pagination controls"+n+"cannot be used without the corresponding pagination directive."}b.maxSize||(b.maxSize=9),b.directionLinks=angular.isDefined(g.directionLinks)?b.$parent.$eval(g.directionLinks):!0,b.boundaryLinks=angular.isDefined(g.boundaryLinks)?b.$parent.$eval(g.boundaryLinks):!1;var o=Math.max(b.maxSize,5);b.pages=[],b.pagination={last:1,current:1},b.range={lower:1,upper:1,total:1},b.$watch(function(){return(a.getCollectionLength(m)+1)*a.getItemsPerPage(m)},function(a){a>0&&i()}),b.$watch(function(){return a.getItemsPerPage(m)},function(a,c){a!=c&&h(b.pagination.current)}),b.$watch(function(){return a.getCurrentPage(m)},function(a,b){a!=b&&h(a)}),b.setCurrent=function(b){k(b)&&a.setCurrentPage(m,b)}}}}]),a.filter("itemsPerPage",["paginationService",function(a){return function(b,d,e){if("undefined"==typeof e&&(e=c),!a.isRegistered(e))throw"pagination directive: the itemsPerPage id argument (id: "+e+") does not match a registered pagination-id.";var f,g;return b instanceof Array?(d=parseInt(d)||9999999999,g=a.isAsyncMode(e)?0:(a.getCurrentPage(e)-1)*d,f=g+d,a.setItemsPerPage(e,d),b.slice(g,f)):b}}]),a.service("paginationService",function(){var a,b={};this.registerInstance=function(c){"undefined"==typeof b[c]&&(b[c]={asyncMode:!1},a=c)},this.isRegistered=function(a){return"undefined"!=typeof b[a]},this.getLastInstanceId=function(){return a},this.setCurrentPageParser=function(a,c,d){b[a].currentPageParser=c,b[a].context=d},this.setCurrentPage=function(a,c){b[a].currentPageParser.assign(b[a].context,c)},this.getCurrentPage=function(a){var c=b[a].currentPageParser;return c?c(b[a].context):1},this.setItemsPerPage=function(a,c){b[a].itemsPerPage=c},this.getItemsPerPage=function(a){return b[a].itemsPerPage},this.setCollectionLength=function(a,c){b[a].collectionLength=c},this.getCollectionLength=function(a){return b[a].collectionLength},this.setAsyncModeTrue=function(a){b[a].asyncMode=!0},this.isAsyncMode=function(a){return b[a].asyncMode}}),a.provider("paginationTemplate",function(){var a="shared/pagination/dirPagination.tpl.html";this.setPath=function(b){a=b},this.$get=function(){return{getPath:function(){return a}}}})}(),angular.module("videoHub").directive("searchAutocomplete",["FilterService","$location",function(a,b){return{templateUrl:"shared/search-autocomplete/search-autocomplete.html",scope:{searchTerm:"=ngModel",updateCallback:"=",service:"="},controller:["$scope","BULBS_AUTOCOMPLETE_EVENT_KEYPRESS",function(c,d){c.data={},c.filterService=a;var e=function(){var b={query:c.searchTerm,filters:a.getFiltersArrayFormattedForBackend(),size:10};return c.service.search.post(b)};c.setItems=function(a){c.data.items=a},c.formatResponse=function(a){var b=a;return _.forEach(b,function(a,b){this[b].type=c.service.type},b),_.forEach(a.meta.facets,c.addFacetObjectsToItems,b),b},c.addFacetObjectsToItems=function(a){_.forEach(a.values,function(b){var c={};c.name=b,c.type=a.facet,this.push(c)},this)},c.updateAutocomplete=function(a){a?e().then(c.formatResponse).then(c.setItems):c.data.items=null},c.groupAndFilterItems=function(a){return _.groupBy(a,"type")},c.formatter=function(a){var b;return _.isUndefined(a)||(b=_.has(a,"name")?a.name:a.title),b},c.onSelect=function(a){_.isUndefined(a)||(a.type===c.service.type?b.path("cms/"+c.service.type+"/"+a.id):(c.filterService.addFilter(a.name,a.type),c.updateCallback(),c.updateAutocomplete(c.searchTerm)))},c.removeItem=function(a){c.filterService.removeFilter(a),c.updateCallback(),c.updateAutocomplete(c.searchTerm)},c.handleKeypress=function(a){27===a.keyCode?c.clearAutocomplete():c.$broadcast(d,a)},c.clearFilters=function(){c.filterService.clearFilters(),c.updateCallback(c.selected)},c.delayClearAutocomplete=function(){_.delay(function(){c.clearAutocomplete(),c.$digest()},100)},c.clearAutocomplete=function(){c.searchTerm="",c.data.items=[],c.updateAutocomplete(c.searchTerm)}}]}}]),angular.module("videoHub").filter("truncate",function(){return function(a,b){return b=b||30,_.trunc(a,b)}}),angular.module("videoHub").controller("SponsorSelectorModalController",["$scope","SponsorService","$modalInstance",function(a,b,c){b.getList().then(function(b){a.sponsors=b}),a.selectSponsor=function(b){a.sponsor=b},a.clearSponsor=function(){a.sponsor=null},a.close=function(){c.close(a.sponsor)}}]),angular.module("videoHub").directive("sponsorSelector",["$modal",function(a){return{link:function(b,c){var d=null;c.addClass("sponsor-selection-modal-opener"),c.on("click",function(){d=a.open({templateUrl:"shared/sponsor-selection-modal/sponsor-selection-modal.html",controller:"SponsorSelectorModalController",scope:b}),d.result.then(function(a){b.sponsor=a,_.isFunction(b.sponsorSelectionModalOnClose)&&b.sponsorSelectionModalOnClose({sponsor:a})})})},restrict:"A",require:"^ngModel",scope:{sponsor:"=ngModel",sponsorSelectonModalTitle:"@",sponsorSelectionModalOnClose:"&"}}}]),angular.module("videoHub").directive("tagsAutocomplete",["$injector",function(a){return{templateUrl:"shared/tags-autocomplete/tags-autocomplete.html",scope:{items:"=",service:"@service",labelAttr:"@",placeholderText:"@",setDirty:"&"},controller:["$scope","AlertService",function(b,c){var d=a.get(b.service);b.fetchItemsThatMatchSearch=function(){_.isEmpty(b.search)||b.search.length<2?b.currentItems=[]:(b.tagsAreBeingFetchedFromTheServer=!0,d.getList({q:b.search}).then(b.updateCurrentItemsAndDisplayDropdown,function(){c.error("Somethign went wrong. Please contact your friendly sysadmin",!0)}))},b.updateCurrentItemsAndDisplayDropdown=function(a){if(b.tagsAreBeingFetchedFromTheServer=!1,_.isUndefined(a))b.currentItems=null;else{var c=_.pluck(b.items,"id");a=_.reject(a,function(a){return _.contains(c,a.id)}),b.currentItems=a}},b.clearSearch=function(){b.search="",b.currentItems=[],b.fetchItemsThatMatchSearch(),b.selectedElement=-1},b.selectedElement=-1,b.controlSelectedElementWithKeyboard=function(a){var c=a.keyCode;if(!_.isEmpty(b.search)){var d=b.currentItems.length-1;switch(c){case 27:b.clearSearch();break;case 40:b.selectedElement=b.selectedElement>=d?0:b.selectedElement+1;break;case 38:b.selectedElement=b.selectedElement<=0?d:b.selectedElement-1;break;case 13:b.tagsAreBeingFetchedFromTheServer||(b.addItem(b.currentItems[b.selectedElement]),b.selectedElement=-1);break;default:return}}},b.addItem=function(a){if(_.isUndefined(a)){a={name:b.search};var e=_.matches(a),f=_.find(b.currentItems,e);f?b.items.push(f):d.post(a).then(function(a){b.items.push(a),b.clearSearch()},function(){c.error("Something went wrong. Plase contact your friendly sysadmin.",!0)})}else b.items.push(a);b.clearSearch()},b.removeItem=function(a){b.items=_.reject(b.items,function(b){return b.id===a.id}),b.setDirty()}}]}}]),angular.module("videoHub").filter("tzDate",["dateFilter","moment","TIMEZONE_NAME",function(a,b,c){return function(d,e){if(!d)return"";var f=b.tz(d,c),g=f.format("YYYY-MM-DDTHH:mm"),h=a(g,e);return h}}]),angular.module("videoHub").directive("videoPlayer",[function(){return{replace:!1,restrict:"E",transclude:!0,templateUrl:"shared/videoplayer/videoplayer.html",link:function(a,b){var c=b.find("video")[0];a.player=videojs(c,{controls:!0,autoplay:!1,width:"auto",height:"auto"}),b.find(".modal").on("hidden.bs.modal",function(){a.player.pause()}),a.$on("$destroy",function(){a.player.dispose()})}}}]);