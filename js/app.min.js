"use strict";angular.module("moment",[]).constant("moment",window.moment),angular.module("$",[]).constant("$",window.$),angular.module("videoHub",["$","ngCookies","ngRoute","ngAnimate","ngMessages","restangular","highcharts-ng","BettyCropper","ui.bootstrap","ui.sortable","LocalStorageModule","moment"]).config(function(RestangularProvider){RestangularProvider.setBaseUrl("/api/v0/"),RestangularProvider.addResponseInterceptor(function(data,operation){if("getList"===operation){var results=data.results;return results&&(results.meta={count:data.count,prev:data.prev,next:data.next}),results}return data});var isoDatesToMoments=function(obj){_.has(obj,"published")&&obj.published&&(obj.published=moment(obj.published))};RestangularProvider.addResponseInterceptor(function(data){return _.isArray(data)?_.each(data,isoDatesToMoments):isoDatesToMoments(data),data});var momentsToIsoDates=function(obj){_.has(obj,"published")&&moment.isMoment(obj.published)&&(obj.published=obj.published.format())};RestangularProvider.addRequestInterceptor(function(element){return momentsToIsoDates(element),element})}).config(function($locationProvider,$httpProvider,$routeProvider,$sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","http://assets.onionstatic.com/videoads/*","http://onionwebtech.s3.amazonaws.com/**","http://tv.theonion.com/**","http://v.theonion.com/**"]),$locationProvider.html5Mode(!0),$routeProvider.when("/cms/",{templateUrl:"components/list-pages/videolist/videolist.html",controller:"VideoListController",reloadOnSearch:!1}).when("/cms/sliders/",{templateUrl:"components/list-pages/slider-list/slider-list.html",controller:"SliderListController"}).when("/cms/sliders/:sliderId/",{templateUrl:"components/detail-pages/slider-detail/slider-detail.html",controller:"SliderDetailController"}).when("/cms/series/",{templateUrl:"components/list-pages/serieslist/serieslist.html",controller:"SeriesListController",reloadOnSearch:!1}).when("/cms/channels/",{templateUrl:"components/list-pages/channellist/channellist.html",controller:"ChannelListController",reloadOnSearch:!1}).when("/cms/sponsors/",{templateUrl:"components/list-pages/sponsorlist/sponsorlist.html",controller:"SponsorListController",reloadOnSearch:!1}).when("/cms/login/",{templateUrl:"components/login/login.html",controller:"LoginController"}).when("/cms/video/new/",{templateUrl:"components/detail-pages/videodetail/videodetail.html",controller:"VideoDetailController"}).when("/cms/video/:videoId/",{templateUrl:"components/detail-pages/videodetail/videodetail.html",controller:"VideoDetailController"}).when("/cms/channel/new/",{templateUrl:"components/detail-pages/channeldetail/channeldetail.html",controller:"ChannelDetailController"}).when("/cms/channel/:channelId/",{templateUrl:"components/detail-pages/channeldetail/channeldetail.html",controller:"ChannelDetailController"}).when("/cms/series/new/",{templateUrl:"components/detail-pages/seriesdetail/seriesdetail.html",controller:"SeriesDetailController"}).when("/cms/series/:seriesId/",{templateUrl:"components/detail-pages/seriesdetail/seriesdetail.html",controller:"SeriesDetailController"}).when("/cms/sponsors/new/",{templateUrl:"components/detail-pages/sponsordetail/sponsordetail.html",controller:"SponsorDetailController"}).when("/cms/sponsors/:sponsorId/",{templateUrl:"components/detail-pages/sponsordetail/sponsordetail.html",controller:"SponsorDetailController"}).otherwise({redirectTo:"/cms/"})}).constant("ValidQueryParamsForListPage",["q","page","f","page_size","order_by"]).constant("DetailPageControllerConstants",{SAVED_ALERT_MESSAGE:"Saved",SOMETHING_WENT_WRONG_ALERT_MESSAGE:"Something went wrong with saving. Please call your friendly sysadmin.",PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE:"Please fill in all required fields.",DELETE_SUCCESSFUL:"Delete successful"}),angular.module("videoHub").controller("ChannelDetailController",function($scope,$routeParams,ChannelService,$location,AlertService,DetailPageControllerConstants,Restangular,SaveButtonStateService){function validateAccentColorFields(input){return input>999?999:input}function displaySomethingWentWrongAlert(){AlertService.error(DetailPageControllerConstants.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)}$scope.channel={},$scope.fields={},$scope.accent_color={},$scope.getChannel=function(){return _.has($routeParams,"channelId")?ChannelService.one($routeParams.channelId).get().then(function(data){$scope.channel=data,$scope.fields.partner=$scope.channel.partner;var accentColorStringAsArray=_.words(data.accent_color);accentColorStringAsArray.length>=1&&($scope.accent_color.r=_.parseInt(accentColorStringAsArray[0])||0),accentColorStringAsArray.length>=2&&($scope.accent_color.g=_.parseInt(accentColorStringAsArray[1])||0),accentColorStringAsArray.length>=3&&($scope.accent_color.b=_.parseInt(accentColorStringAsArray[2])||0)},function(data){console.log(data)}):($scope.channel={},void Restangular.restangularizeElement(null,$scope.channel,"channels"))},$scope.save=function(){$scope.channelDetailForm.$valid?($scope.channel.partner=_.has($scope.fields.partner,"id")?$scope.fields.partner.id:null,$scope.channel.accent_color=$scope.getRGBValueFromFields(),$scope.channel.save().then($scope.successCallback,displaySomethingWentWrongAlert)):_.has($scope.channelDetailForm.$error,"number")?AlertService.error("Accent Color values must be numbers.",!0):AlertService.error(DetailPageControllerConstants.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},$scope.getRGBValueFromFields=function(){var compiled=_.template("<%= r %>,<%= g %>,<%= b %>"),params={r:$scope.accent_color.r||0,g:$scope.accent_color.g||0,b:$scope.accent_color.b||0};return compiled(params)},$scope.successCallback=function(channel){$scope.channelDetailForm.$setPristine(),SaveButtonStateService.displaySavingAnimation().then(function(){_.has($routeParams,"channelId")||$location.path("cms/channel/"+channel.id+"/")})},$scope.$watch("accent_color.r",function(newValue){$scope.accent_color.r=validateAccentColorFields(newValue)}),$scope.$watch("accent_color.g",function(newValue){$scope.accent_color.g=validateAccentColorFields(newValue)}),$scope.$watch("accent_color.b",function(newValue){$scope.accent_color.b=validateAccentColorFields(newValue)}),$scope.dateTimeSelectorCallback=function(newDate){$scope.channel.published=newDate,$scope.save()},$scope.delete=function(){AlertService.info("If you would like to delete a channel, please contact your friendly sysadmin.",!0)},$scope.getChannel()}),angular.module("videoHub").controller("SeriesDetailController",function($scope,$routeParams,SeriesService,$location,AlertService,Restangular,DetailPageControllerConstants,SaveButtonStateService){function displaySomethingWentWrongAlert(){AlertService.error(DetailPageControllerConstants.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)}$scope.series={},$scope.data={},$scope.getSeries=function(){return _.has($routeParams,"seriesId")?SeriesService.one($routeParams.seriesId).get().then(function(data){$scope.series=data,$scope.dropdownFields.channel=data.channel,$scope.data.sponsor=data.sponsor,_.isUndefined(data.published)||($scope.data.published=data.published)},function(data){console.log(data)}):($scope.series={},Restangular.restangularizeElement(null,$scope.series,"series"),$scope.sponsor={},void 0)},$scope.save=function(){$scope.seriesDetailForm.$valid?($scope.series.channel=_.has($scope.dropdownFields.channel,"id")?$scope.dropdownFields.channel.id:null,$scope.series.sponsor=_.has($scope.data.sponsor,"id")?$scope.data.sponsor.id:null,$scope.series.published=_.isEmpty($scope.data.published)?null:$scope.data.published,$scope.series.save().then($scope.successCallback,displaySomethingWentWrongAlert)):AlertService.error(DetailPageControllerConstants.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},$scope.successCallback=function(series){$scope.seriesDetailForm.$setPristine(),SaveButtonStateService.displaySavingAnimation().then(function(){_.has($routeParams,"seriesId")||$location.path("cms/series/"+series.id)})},$scope.dateTimeSelectorCallback=function(newDate){$scope.data.published=newDate,$scope.save()},$scope.delete=function(){AlertService.info("If you would like to delete a series, please contact your friendly sysadmin.",!0)},$().tooltip&&$(".cropInfoTooltip").tooltip(),$scope.dropdownFields={},$scope.getSeries()}),angular.module("videoHub").controller("SliderDetailController",function($scope,$q,$routeParams,AlertService,SliderService,DetailPageControllerConstants,Restangular){var normalizeSlideIndicies=function(){_.each($scope.slider.slides,function(slide,i){slide.position=i})};$scope.slider={},$scope.$getSlider=function(sliderId){return SliderService.one(sliderId).get().then(function(data){$scope.slider=data,normalizeSlideIndicies()}).catch(function(data){console.log(data)})},$scope.sortableOptions={containment:"document",opacity:.75,placeholder:"dropzone",stop:function(){$scope.sliderDetailForm.$setDirty(),normalizeSlideIndicies()}},$scope.addSlide=function(){_.isArray($scope.slider.slides)||($scope.slider.slides=[]),$scope.slider.slides.push({}),$scope.sliderDetailForm.$setDirty(),normalizeSlideIndicies()},$scope.removeSlide=function(slide){if(slide){var i=_.findIndex($scope.slider.slides,slide);i>=0&&($scope.slider.slides.splice(i,1),$scope.sliderDetailForm.$setDirty(),normalizeSlideIndicies())}},$scope.$saveSlider=function(){var promise;return promise=$scope.sliderDetailForm.$valid?$scope.slider.save().then(function(){return $scope.sliderDetailForm.$setPristine(),AlertService.success(DetailPageControllerConstants.SAVED_ALERT_MESSAGE,!0)}).catch(function(){return AlertService.error(DetailPageControllerConstants.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)}):AlertService.error(DetailPageControllerConstants.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},$scope.$deleteSlider=function(){return AlertService.info("If you would like to delete a slider, please contact your friendly sysadmin.",!0)},_.has($routeParams,"sliderId")?$scope.$getSlider($routeParams.sliderId):Restangular.restangularizeElement(null,$scope.slider,"sliders")}),angular.module("videoHub").directive("sliderDetailSlide",[function(){return{restrict:"E",scope:{slide:"=slideData",removeFunction:"&",parentForm:"="},templateUrl:"components/detail-pages/slider-detail/slider-detail-slide/slider-detail-slide.html"}}]),angular.module("videoHub").controller("SponsorDetailController",function($scope,$routeParams,SponsorService,$location,AlertService,Restangular,DetailPageControllerConstants){function displaySaveSuccessfulAlert(){return AlertService.success(DetailPageControllerConstants.SAVED_ALERT_MESSAGE,!0)}function displaySomethingWentWrongAlert(){AlertService.error(DetailPageControllerConstants.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)}$scope.sponsor={},$scope.hideDatetimeSelectionModal=!0,$scope.getSponsor=function(){return _.has($routeParams,"sponsorId")?SponsorService.one($routeParams.sponsorId).get().then(function(data){$scope.sponsor=data},function(data){console.log(data)}):($scope.sponsor={},void Restangular.restangularizeElement(null,$scope.sponsor,"sponsors"))},$scope.save=function(){$scope.sponsorDetailForm.$valid?$scope.sponsor.save().then($scope.successCallback,displaySomethingWentWrongAlert):AlertService.error(DetailPageControllerConstants.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},$scope.successCallback=function(newSponsor){displaySaveSuccessfulAlert().then(function(){_.has($routeParams,"sponsorId")||$location.path("cms/sponsors/"+newSponsor.id)})},$scope.delete=function(){AlertService.info("If you would like to delete a sponsor, please contact your friendly sysadmin.",!0)},$scope.getSponsor()}),angular.module("videoHub").directive("channelSelection",["DropdownFilterService",function(DropdownFilterService){return{templateUrl:"components/detail-pages/videodetail/channelselection/channelselection.html",transclude:!0,link:function($scope){$scope.data=DropdownFilterService.data,$scope.channelFieldChanged=function(){DropdownFilterService.setChannel($scope.data.channel)},$scope.seriesFieldChanged=function(){DropdownFilterService.setSeries($scope.data.series)},DropdownFilterService.populateChannelList()}}}]),angular.module("videoHub").service("DropdownFilterService",function(ChannelService,SeriesService,SeasonService){var DropdownFilterService=this;DropdownFilterService.data={},DropdownFilterService.filter={},DropdownFilterService.setChannel=function(newChannel){newChannel?(DropdownFilterService.data.channel=newChannel,DropdownFilterService.updateFilter(),DropdownFilterService.setSeries(null),DropdownFilterService.populateSeriesList()):DropdownFilterService.clear()},DropdownFilterService.setSeries=function(newSeries){newSeries?(DropdownFilterService.data.series=newSeries,DropdownFilterService.updateFilter(),DropdownFilterService.populateSeasonList()):(DropdownFilterService.data.series=null,DropdownFilterService.data.season=null)},DropdownFilterService.setSeason=function(newSeason){newSeason?(DropdownFilterService.data.season=newSeason,DropdownFilterService.season=newSeason):DropdownFilterService.season=null},DropdownFilterService.setChannelList=function(channelList){DropdownFilterService.data.channelList=channelList},DropdownFilterService.clear=function(){DropdownFilterService.data.channel=null,DropdownFilterService.data.series=null,DropdownFilterService.data.season=null},DropdownFilterService.updateFilter=function(){DropdownFilterService.filter.channelId=_.has(DropdownFilterService.data.channel,"id")?DropdownFilterService.data.channel.id:null,DropdownFilterService.filter.seriesId=_.has(DropdownFilterService.data.series,"id")?DropdownFilterService.data.series.id:null},DropdownFilterService.populateChannelList=function(){return ChannelService.getList({page_size:100}).then(DropdownFilterService.setChannelList)},DropdownFilterService.populateSeriesList=function(){return SeriesService.getList({page_size:100,f:"channel:"+DropdownFilterService.filter.channelId}).then(function(data){DropdownFilterService.data.seriesList=data})},DropdownFilterService.populateSeasonList=function(){return SeasonService.getList({page_size:100,f:"series:"+DropdownFilterService.filter.seriesId}).then(function(data){DropdownFilterService.data.seasonList=data})}}),angular.module("videoHub").controller("VideoDetailController",function($scope,$routeParams,VideoService,$location,SaveButtonStateService,DropdownFilterService,Restangular,DetailPageControllerConstants,AlertService){function displaySomethingWentWrongAlert(){AlertService.error(DetailPageControllerConstants.SOMETHING_WENT_WRONG_ALERT_MESSAGE,!0)}$scope.video={},$scope.getVideo=function(){return _.has($routeParams,"videoId")?VideoService.one($routeParams.videoId).get().then($scope.setVideo,function(data){console.log(data)}):($scope.video={},Restangular.restangularizeElement(null,$scope.video,"videos"),$scope.setVideo($scope.video),void 0)},$scope.setVideo=function(data){_.isEmpty(data.input)&&(data.input=""),$scope.video=data,_.isUndefined($scope.video.tags)&&($scope.video.tags=[]),$scope.data.tagObjects=$scope.video.tags,$scope.video.tags=_.pluck($scope.video.tags,"id"),_.isUndefined(data.channel)||DropdownFilterService.setChannel(data.channel),_.isUndefined(data.series)||DropdownFilterService.setSeries(data.series),_.isUndefined(data.sponsor)||($scope.data.sponsor=data.sponsor),_.isUndefined(data.published)||($scope.published=data.published)},$scope.save=function(){$scope.videoDetailForm.$valid?($scope.video.channel=_.has(DropdownFilterService.data.channel,"id")?DropdownFilterService.data.channel.id:null,$scope.video.series=_.has(DropdownFilterService.data.series,"id")?DropdownFilterService.data.series.id:null,$scope.video.season=_.has(DropdownFilterService.data.season,"id")?DropdownFilterService.data.season.id:null,$scope.video.tags=_.pluck($scope.data.tagObjects,"id"),$scope.video.save().then($scope.successCallback,displaySomethingWentWrongAlert)):AlertService.error(DetailPageControllerConstants.PLEASE_FILL_IN_ALL_REQUIRED_FIELDS_ALERT_MESSAGE,!0)},$scope.successCallback=function(video){$scope.videoDetailForm.$setPristine(),SaveButtonStateService.displaySavingAnimation().then(function(){_.has($routeParams,"videoId")||$location.path("cms/video/"+video.id+"/")})},$scope.delete=function(){$scope.video.remove().then(function(){AlertService.success(DetailPageControllerConstants.DELETE_SUCCESSFUL,!0).then(function(){$location.path("cms/")})})},$scope.dateTimeSelectorCallback=function(newDate){$scope.video.published=newDate,$scope.save()},$().tooltip&&$(".videoMustBeSavedBeforeUpload").tooltip(),$scope.data={},$scope.getVideo()}),angular.module("videoHub").constant("VideoFieldConstants",{FILE_TOO_LARGE_ERROR_MESSAGE:"Upload file cannot be larger than 1024MB.",MUST_UPLOAD_FILES_ERROR_MESSAGE:"You must upload a video file.",PLEASE_SELECT_A_FILE_ERROR_MESSAGE:"Please select a file.",UPLOAD_COMPLETE_SUCCESS_MESSAGE:"Upload Complete"}).directive("videoField",function(Zencoder,$q){return{templateUrl:"components/detail-pages/videodetail/videofield/videofield.html",transclude:!0,controller:function($scope,$timeout,VideoFieldConstants,VideoService,AlertService){$scope.uploadVideo=function(){var fileField=$("#"+$scope.video.id+"-file-field");fileField.unbind("change"),fileField.bind("change",function(event){var file=event.target.files[0];$scope.validateVideoFile(file).then($scope.addVideo).then(Zencoder.uploadToS3AndEncode).then(function(){$scope.encodingProgress=100,$scope.fetchNewVideoObject()},function(e){AlertService.error(e,!0)},function(e){_.isUndefined(e)||(e.loaded?$scope.uploadProgress=Math.round(e.loaded/e.total*100):e.progress&&($scope.encodingProgress=Math.round(e.progress)||0))})}),fileField.click()},$scope.validateVideoFile=function(file){var validateVideoFileDeferred=$q.defer();return file?file.size>1073741824?validateVideoFileDeferred.reject(VideoFieldConstants.FILE_TOO_LARGE_ERROR_MESSAGE):0!==file.type.indexOf("video/")?validateVideoFileDeferred.reject(VideoFieldConstants.MUST_UPLOAD_FILES_ERROR_MESSAGE):validateVideoFileDeferred.resolve(file):validateVideoFileDeferred.reject(VideoFieldConstants.PLEASE_SELECT_A_FILE_ERROR_MESSAGE),validateVideoFileDeferred.promise},$scope.addVideo=function(file){var addVideoDeferred=$q.defer();return $scope.video.doGET("encoding_auth").then(function(encodingPayload){$scope.video.encoding_payload=encodingPayload;var uploadToS3Arguments={file:file,videoObject:$scope.video};addVideoDeferred.resolve(uploadToS3Arguments)}),addVideoDeferred.promise},$scope.checkIfSourcesHaveLoadedAndRetryIfTheyAreNot=function(response){_.isEmpty(response.sources)?$timeout($scope.fetchNewVideoObject,2e3):$scope.video=response},$scope.fetchNewVideoObject=function(){VideoService.one($scope.video.id).get().then($scope.checkIfSourcesHaveLoadedAndRetryIfTheyAreNot)}}}}),angular.module("videoHub").constant("ZencoderConstants",{UPLOAD_TO_S3_PROGRESS_MESSAGE:"Uploading X% complete",UPLOAD_TO_S3_UPLOAD_BEGINNING_MESSAGE:"Uploading...",UPLOAD_TO_S3_UPLOAD_COMPLETE_MESSAGE:"Upload Complete. Begin Encoding.",UPLOAD_TO_S3_UPLOAD_FAILED_MESSAGE:"Upload Failed",ENCODE_FAILED_MESSAGE:"Encoding has failed.",ENCODE_PROGRESS_MESSAGE:"Encoding: X%"}).service("Zencoder",function($http,$q,$interval,ZencoderConstants){function uploadToS3(file,videoObject){var s3Config=videoObject.encoding_payload,s3deferred=$q.defer(),formData=new FormData;formData.append("key",s3Config.key),formData.append("AWSAccessKeyId",s3Config.AWSAccessKeyId),formData.append("acl",s3Config.acl),formData.append("success_action_status",s3Config.success_action_status),formData.append("policy",s3Config.policy),formData.append("signature",s3Config.signature),formData.append("file",file);var xhr=new XMLHttpRequest;return xhr.open("POST",s3Config.upload_endpoint),xhr.upload.onprogress=function(e){s3deferred.notify(e)},xhr.onload=function(){s3deferred.resolve(videoObject)},xhr.addEventListener("error",function(){s3deferred.reject(ZencoderConstants.UPLOAD_TO_S3_UPLOAD_FAILED_MESSAGE)}),xhr.send(formData),s3deferred.promise}function encode(videoObject){var encodeDeferred=$q.defer();return videoObject.doPOST({},"encode").then(function(response){var zencoderProgressEndpoint=response.json,progressInterval=$interval(function(){$http({url:zencoderProgressEndpoint,method:"GET",ignoreAuthorizationHeader:!0}).then(function(response){"finished"===response.data.state?(encodeDeferred.resolve(videoObject),$interval.cancel(progressInterval)):"failed"===response.data.state?(encodeDeferred.reject(ZencoderConstants.ENCODE_FAILED_MESSAGE),$interval.cancel(progressInterval)):_.isUndefined(response.data.progress)||encodeDeferred.notify(response.data)})},2e3)},function(data){encodeDeferred.reject(data)}),encodeDeferred.promise}this.uploadToS3AndEncode=function(config){var uploadToS3AndEncodeDeferred=$q.defer(),file=config.file,videoObject=config.videoObject,successCallback=function(success){uploadToS3AndEncodeDeferred.resolve(success)},errorCallback=function(error){uploadToS3AndEncodeDeferred.reject(error)},notifyCallback=function(notify){uploadToS3AndEncodeDeferred.notify(notify)};return uploadToS3(file,videoObject).then(encode,errorCallback,notifyCallback).then(successCallback,errorCallback,notifyCallback),uploadToS3AndEncodeDeferred.promise}}),angular.module("videoHub").controller("ChannelListController",function($scope,$location,$routeParams,$rootScope,ListService){ListService.setService("ChannelService");var update=function(){$scope.list=ListService.data.list,$scope.totalItems=ListService.data.totalItems,$scope.params=ListService.getParams()};ListService.updateList().then(update),$scope.changeToEditPage=function(id){$location.path("cms/channel/"+id+"/")},$scope.setOrderAndUpdateList=function(newOrderValue){ListService.setOrder(newOrderValue),ListService.updateList().then(update)},$scope.clearSearchAndUpdateList=function(){ListService.clearSearch(),ListService.updateList().then(update)},$scope.pageChanged=function(newPageNumber){ListService.setPage(newPageNumber),ListService.updateList().then(update)},$scope.selectSearchBox=function(){$("#searchBox").focus()},$scope.setSearchAndUpdateList=function(){ListService.setSearch($scope.params.q),ListService.updateList().then(update)}}),angular.module("videoHub").controller("SeriesListController",function($scope,$location,$routeParams,$rootScope,ListService){ListService.setService("SeriesService");var update=function(){$scope.list=ListService.data.list,$scope.totalItems=ListService.data.totalItems,$scope.params=ListService.getParams()};ListService.updateList().then(update),$scope.changeToEditPage=function(id){$location.path("cms/series/"+id+"/")},$scope.setOrderAndUpdateList=function(newOrderValue){ListService.setOrder(newOrderValue),ListService.updateList().then(update)},$scope.clearSearchAndUpdateList=function(){ListService.clearSearch(),ListService.updateList().then(update)},$scope.pageChanged=function(newPageNumber){ListService.setPage(newPageNumber),ListService.updateList().then(update)},$scope.selectSearchBox=function(){$("#searchBox").focus()},$scope.setSearchAndUpdateList=function(){ListService.setSearch($scope.params.q),ListService.updateList().then(update)}}),angular.module("videoHub").controller("SliderListController",function($,$scope,$location,ListService){ListService.setService("SliderService");var update=function(){$scope.sliders=ListService.data.list,$scope.totalItems=ListService.data.totalItems,$scope.params=ListService.getParams()};ListService.updateList().then(update),$scope.setFilterAndUpdateList=function(newFilterValue){ListService.setFilter(newFilterValue),ListService.updateList().then(update)},$scope.changeToEditPage=function(id){$location.path("cms/sliders/"+id+"/")},$scope.setOrderAndUpdateList=function(newOrderValue){ListService.setOrder(newOrderValue),ListService.updateList().then(update)},$scope.clearSearchAndUpdateList=function(){ListService.clearSearch(),ListService.updateList().then(update)},$scope.pageChanged=function(newPageNumber){ListService.setPage(newPageNumber),ListService.updateList().then(update)},$scope.selectSearchBox=function(){$("#searchBox").focus()},$scope.setSearchAndUpdateList=function(){ListService.setService($scope.params.q),ListService.updateList().then(update)}}),angular.module("videoHub").controller("SponsorListController",function($scope,$location,$routeParams,$rootScope,ListService){ListService.setService("SponsorService");var update=function(){$scope.list=ListService.data.list,$scope.totalItems=ListService.data.totalItems,$scope.params=ListService.getParams()};ListService.updateList().then(update),$scope.changeToEditPage=function(id){$location.path("cms/sponsors/"+id+"/")},$scope.setOrderAndUpdateList=function(newOrderValue){ListService.setOrder(newOrderValue),ListService.updateList().then(update)},$scope.clearSearchAndUpdateList=function(){ListService.clearSearch(),ListService.updateList().then(update)},$scope.selectSearchBox=function(){$("#searchBox").focus()},$scope.pageChanged=function(newPageNumber){ListService.setPage(newPageNumber),ListService.updateList().then(update)},$scope.setSearchAndUpdateList=function(){ListService.setSearch($scope.params.q),ListService.updateList().then(update)}}),angular.module("videoHub").controller("VideoListController",function($scope,$location,$routeParams,$rootScope,ListService){ListService.setService("VideoService");var update=function(){$scope.list=ListService.data.list,$scope.totalItems=ListService.data.totalItems,$scope.params=ListService.getParams()};ListService.updateList().then(update),$scope.changeToEditPage=function(id){$location.path("cms/video/"+id+"/")},$scope.setOrderAndUpdateList=function(newOrderValue){ListService.setOrder(newOrderValue),ListService.updateList().then(update)},$scope.clearSearchAndUpdateList=function(){ListService.clearSearch(),ListService.updateList().then(update)},$scope.selectSearchBox=function(){$("#searchBox").focus()},$scope.pageChanged=function(newPageNumber){ListService.setPage(newPageNumber),ListService.updateList().then(update)},$scope.setSearchAndUpdateList=function(){ListService.setSearch($scope.params.q),ListService.updateList().then(update)},$scope.new=function(){$location.path("cms/new/")}}),angular.module("videoHub").controller("LoginController",function($scope,authService,$location,$rootScope){$rootScope.showSearchBar=!1,$rootScope.showSaveButton=!1,$scope.username="",$scope.password="",$scope.submitLogin=function(){authService.login($scope.username,$scope.password)}}),angular.module("videoHub").directive("alertbar",function(){return{templateUrl:"shared/alert/alert-directive.html",restrict:"E",controller:function($scope,AlertService){$scope.alertStatus=AlertService.alertStatus}}}),angular.module("videoHub").constant("AlertServiceConstants",{TIME_TO_WAIT_BEFORE_CLEARING:2e3}).service("AlertService",function($timeout,$q,AlertServiceConstants){this.alertStatus={},this.clear=function(clearAfterDisplayingMessageFlag){_.isUndefined(clearAfterDisplayingMessageFlag)&&this.setAlertStatusElementsToFalse();var alertDeferred=$q.defer(),alertService=this;return clearAfterDisplayingMessageFlag?$timeout(function(){alertService.setAlertStatusElementsToFalse(),alertDeferred.resolve()},AlertServiceConstants.TIME_TO_WAIT_BEFORE_CLEARING):alertDeferred.resolve(),alertDeferred.promise},this.setAlertStatusElementsToFalse=function(){this.alertStatus.error=!1,this.alertStatus.info=!1,this.alertStatus.success=!1},this.success=function(message,clearAfterDisplayingMessageFlag){return this.clear(),this.alertStatus.success=message,this.clear(clearAfterDisplayingMessageFlag)},this.error=function(message,clearAfterDisplayingMessageFlag){return this.clear(),this.alertStatus.error=message,this.clear(clearAfterDisplayingMessageFlag)},this.info=function(message,clearAfterDisplayingMessageFlag){return this.clear(),this.alertStatus.info=message,this.clear(clearAfterDisplayingMessageFlag)}}),angular.module("videoHub").factory("ChannelService",function(Restangular){return Restangular.service("channels")}),angular.module("videoHub").factory("SeasonService",function(Restangular){return Restangular.service("seasons")}),angular.module("videoHub").factory("SeriesService",function(Restangular){return Restangular.service("series")}),angular.module("videoHub").factory("SliderService",function(Restangular){return Restangular.service("sliders")}),angular.module("videoHub").factory("SlidesService",function(Restangular){return Restangular.service("slides")}),angular.module("videoHub").factory("SponsorService",function(Restangular){return Restangular.service("sponsors")}),angular.module("videoHub").factory("TagsService",function(Restangular){return Restangular.service("tags")}),angular.module("videoHub").factory("VideoService",function(Restangular){return Restangular.service("videos")}),angular.module("videoHub").factory("authInterceptor",["$rootScope","$q","$location","$injector","httpRequestBuffer","localStorageService",function($rootScope,$q,$location,$injector,httpRequestBuffer,localStorageService){return{request:function(config){config.headers=config.headers||{};var token=localStorageService.get("authToken"),isBettyCropperRequest=_.has(config.headers,"X-Betty-Api-Key");return token&&(config.ignoreAuthorizationHeader||isBettyCropperRequest||(config.headers.Authorization="JWT "+token)),config},responseError:function(response){if(response.config){var ignoreAuthModule=response.config.ignoreAuthModule||response.config.headers.ignoreAuthModule;if(!ignoreAuthModule&&403===response.status){var deferred=$q.defer();httpRequestBuffer.append(response.config,deferred);var authService=$injector.get("authService");authService.refreshToken()}}return $q.reject(response)}}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("authInterceptor")}]).service("authService",["$http","$rootScope","$location","httpRequestBuffer","localStorageService","AlertService","CurrentUser",function($http,$rootScope,$location,httpRequestBuffer,localStorageService,AlertService,CurrentUser){var _login=function(username,password){return $http.post("/api/token/auth",{username:username,password:password}).success(function(response){localStorageService.set("authToken",response.token),CurrentUser.setCurrentUser(username),$location.path("cms/")}).error(function(){AlertService.error("Username or password provided is incorrect.",!0)})},_refreshToken=function(){var token=localStorageService.get("authToken");return $http.post("/api/token/refresh",{token:token},{ignoreAuthModule:!0}).success(function(response){localStorageService.set("authToken",response.token),httpRequestBuffer.retryAll()}).error(function(){httpRequestBuffer.rejectAll(),AlertService.error("You failed to authenticate. Redirecting to login.",!0),$location.path("cms/login")})};return{login:_login,refreshToken:_refreshToken}}]).factory("httpRequestBuffer",["$injector",function($injector){function _retryHttpRequest(config,deferred){function successCallback(response){deferred.resolve(response)}function errorCallback(response){deferred.reject(response)}$http=$http||$injector.get("$http"),config.headers.ignoreAuthModule=!0,$http(config).then(successCallback,errorCallback)}var $http,buffer=[];return{append:function(config,deferred){buffer.push({config:config,deferred:deferred})},rejectAll:function(reason){reason&&_.each(buffer,function(request){request.deferred.reject(reason)}),buffer=[]},retryAll:function(){_.each(buffer,function(request){_retryHttpRequest(request.config,request.deferred)}),buffer=[]}}}]),angular.module("videoHub").directive("autocomplete",function($injector){return{templateUrl:"shared/autocomplete/autocomplete.html",replace:!0,scope:{model:"=",service:"@service",labelAttr:"@",placeholderText:"@"},link:function(scope,element,attrs){scope.isRequired="true"===attrs.isRequired},controller:function($scope){var service=$injector.get($scope.service);$scope.doSearchAndUpdateCurrentModels=function(){return $scope.modelSelected||$scope.showDropdown||_.isEmpty($scope.search)||$scope.search.length<4?($scope.currentModels=[],void($scope.showDropdown=!_.isEmpty($scope.currentModels)&&!$scope.modelSelected)):void service.getList({q:$scope.search}).then($scope.updateCurrentModelsAndDisplayDropdown)
},$scope.updateCurrentModelsAndDisplayDropdown=function(data){_.isUndefined(data)?($scope.currentModels=null,$scope.showDropdown=!1):($scope.currentModels=data,$scope.showDropdown=!_.isEmpty($scope.currentModels)&&!$scope.modelSelected)},$scope.selectedElement=0,$scope.controlSelectedElementWithKeyboard=function(event){var keyCode=event.keyCode;if($scope.currentModels){var lastIndexOfCurrentModels=$scope.currentModels.length-1;switch(keyCode){case 27:$scope.disableDropdown();break;case 40:$scope.selectedElement=$scope.selectedElement===lastIndexOfCurrentModels?0:$scope.selectedElement+1;break;case 38:$scope.selectedElement=0===$scope.selectedElement?lastIndexOfCurrentModels:$scope.selectedElement-1;break;case 13:$scope.setModel($scope.currentModels[$scope.selectedElement]),$scope.selectedElement=0;break;default:return}}},$scope.disableDropdown=function(){$scope.showDropdown=!1,$scope.selectedElement=0,$scope.search="",$scope.modelSelected=!1},$scope.setModel=function(model){_.isUndefined(unbindListener)||unbindListener(),$scope.model=model,$scope.search=model[$scope.labelAttr],$scope.currentModels&&($scope.currentModels=null),$scope.modelSelected=!0,$scope.showDropdown=!1,$scope.selectedElement=0},$scope.clear=function(){$scope.model=null,$scope.modelSelected=!1,$scope.search=""};var unbindListener=$scope.$watch("model",function(newValue){_.has(newValue,"name")&&($scope.setModel(newValue),unbindListener())})}}}),function(){function BettyCropperService($http,$interpolate,$q,IMAGE_SERVER_URL,BC_API_KEY,BettyImage){function upload(){var uploadImageDeferred=$q.defer();angular.element(fileInputId).remove();var fileInput=angular.element(inputTemplate);return angular.element("body").append(fileInput),fileInput.click(),fileInput.unbind("change"),fileInput.bind("change",function(e){1!==e.target.files.length&&uploadImageDeferred.reject("We need exactly one image!");var file=e.target.files[0];0!==file.type.indexOf("image/")&&uploadImageDeferred.reject("Not an image!"),file.size>10485760&&uploadImageDeferred.reject("The file is too large!");var imageData=new FormData;imageData.append("image",file),$http({method:"POST",url:IMAGE_SERVER_URL+"/api/new",headers:{"X-Betty-Api-Key":BC_API_KEY,"Content-Type":void 0,"X-CSRFToken":void 0},data:imageData,transformRequest:angular.identity,transformResponse:function(data){"string"==typeof data&&(data=$.parseJSON(data));var image=new BettyImage(data);return image}}).success(function(success){uploadImageDeferred.resolve(success)}).error(function(error){uploadImageDeferred.reject(error)})}),uploadImageDeferred.promise}function get(id){return $http({method:"GET",url:IMAGE_SERVER_URL+"/api/"+id,headers:{"X-Betty-Api-Key":BC_API_KEY,"Content-Type":void 0,"X-CSRFToken":void 0},transformRequest:angular.identity,transformResponse:function(data){return"string"==typeof data&&(data=$.parseJSON(data)),new BettyImage(data)}})}function detailPatch(id,name,credit,selections){return $http({method:"PATCH",url:IMAGE_SERVER_URL+"/api/"+id,headers:{"X-Betty-Api-Key":BC_API_KEY,"Content-Type":void 0,"X-CSRFToken":void 0},data:{name:name,credit:credit,selections:selections},transformRequest:angular.identity,transformResponse:function(data){return"string"==typeof data&&(data=$.parseJSON(data)),new BettyImage(data)}})}function updateSelection(id,ratio,selections){return $http({method:"POST",url:IMAGE_SERVER_URL+"/api/"+id+"/"+ratio,headers:{"X-Betty-Api-Key":BC_API_KEY,"Content-Type":void 0,"X-CSRFToken":void 0},data:selections})}var fileInputId="#bulbs-cms-hidden-image-file-input",inputTemplate='<input id="bulbs-cms-hidden-image-file-input" type="file" accept="image/*" style="position: absolute; left:-99999px;" name="image" />';this.upload=upload,this.get=get,this.detail=get,this.detailPatch=detailPatch,this.updateSelection=updateSelection}function BettyImageFactory($interpolate,$http,IMAGE_SERVER_URL,BC_API_KEY,DEFAULT_IMAGE_WIDTH,Selection){function BettyImage(data){this.id=data.id,this.name=data.name,this.width=data.width,this.height=data.height,this.selections={};for(var ratio in data.selections)this.selections[ratio]=new Selection(data.selections[ratio])}return BettyImage.prototype.scaleToFit=function(width,height){var scale;if(width&&height){var fitRatio=width/height,thisRatio=this.width/this.height;scale=fitRatio>thisRatio?height/this.height:width/this.width}else width&&(scale=width/this.width),height&&(scale=height/this.height);var scaled={width:Math.round(this.width*scale),height:Math.round(this.height*scale),scale:scale};return scaled},BettyImage.prototype.getStyles=function(width,height,ratio){0===height&&(height=null);var selection=this.selections[ratio],scaledSelection=selection.scaleToFit(width,height);return{"background-image":"url("+this.url("original",DEFAULT_IMAGE_WIDTH,"jpg")+")","background-size":Math.floor(scaledSelection.width()/selection.width()*this.width)+"px","background-position":"-"+scaledSelection.x0+"px -"+scaledSelection.y0+"px",height:scaledSelection.height()+"px",width:scaledSelection.width()+"px","background-repeat":"no-repeat",position:"relative"}},BettyImage.prototype.url=function(ratio,width,format){for(var exp=$interpolate("{{ base_url }}/{{ id }}/{{ ratio }}/{{ width }}.{{ format }}"),idStr=this.id.toString(),segmentedId="",i=0;i<idStr.length;i++)i%4===0&&0!==i&&(segmentedId+="/"),segmentedId+=idStr.substr(i,1);return exp({base_url:IMAGE_SERVER_URL,id:segmentedId,ratio:ratio,width:width,format:format})},BettyImage.prototype.updateSelection=function(ratio,selection){var data={x0:selection.x0,x1:selection.x1,y0:selection.y0,y1:selection.y1};return selection.source&&(data.source=selection.source),$http({method:"POST",url:IMAGE_SERVER_URL+"/api/"+this.id+"/"+ratio,headers:{"X-Betty-Api-Key":BC_API_KEY,"Content-Type":void 0,"X-CSRFToken":void 0},data:data,transformResponse:function(data){return"string"==typeof data&&(data=$.parseJSON(data)),[ratio,new Selection(data.selections[ratio])]}})},BettyImage}function SelectionFactory(){function Selection(data){this.x0=data.x0,this.x1=data.x1,this.y0=data.y0,this.y1=data.y1,this.source=data.source}return Selection.prototype.width=function(){return this.x1-this.x0},Selection.prototype.height=function(){return this.y1-this.y0},Selection.prototype.scaleBy=function(scale){var scaledToFit=new Selection({x0:Math.round(this.x0*scale),x1:Math.round(this.x1*scale),y0:Math.round(this.y0*scale),y1:Math.round(this.y1*scale)});return scaledToFit},Selection.prototype.scaleToFit=function(width,height){var scale;if(width&&height){var fitRatio=width/height,thisRatio=this.width()/this.height();scale=fitRatio>thisRatio?height/this.height():width/this.width()}else width&&(scale=width/this.width()),height&&(scale=height/this.height());return this.scaleBy(scale)},Selection}angular.module("BettyCropper",["restangular"]).value("DEFAULT_IMAGE_WIDTH",1200).factory("Selection",SelectionFactory).factory("BettyImage",BettyImageFactory).service("BettyCropper",BettyCropperService)}(),angular.module("videoHub").directive("bettyeditable",function($http,BettyCropper,openImageCropModal){return{restrict:"E",templateUrl:"shared/bettycropper/bettyeditable.html",scope:{image:"=",addStyles:"@",placeholderText:"@",hideMetas:"=",ratio:"@",editable:"=?",imageChangeCallback:"="},controller:function($scope){$scope.editable=angular.isDefined($scope.editable)?$scope.editable:!0,$scope.callImageChangeCallback=function(param){_.isFunction($scope.imageChangeCallback)&&$scope.imageChangeCallback(param)},$scope.upload=function(){BettyCropper.upload().then(function(success){$scope.image={id:success.id,caption:null,alt:null},$scope.bettyImage=success,$scope.callImageChangeCallback(success)},function(error){console.log(error)},function(progress){console.log(progress)})},$scope.edit=function(){openImageCropModal($scope.image).then(function(image){null===image.id?$scope.image=null:($scope.image=image,BettyCropper.get($scope.image.id).then(function(response){$scope.bettyImage=response.data,$scope.setStyles()})),$scope.callImageChangeCallback()})}},link:function(scope,element){void 0===scope.bettyImage&&(scope.bettyImage=null),scope.setStyles=function(){if(scope.bettyImage)scope.imageStyling=scope.bettyImage.getStyles(element.parent().width(),element.parent().height(),scope.ratio);else{var ratioWidth=parseInt(scope.ratio.split("x")[0],10),ratioHeight=parseInt(scope.ratio.split("x")[1],10);scope.imageStyling={"background-color":"#333",position:"relative",width:element.parent().width(),height:Math.floor(element.parent().width()*ratioHeight/ratioWidth)+"px"}}},scope.$watch("image",function(newImage){newImage&&newImage.id&&BettyCropper.get(newImage.id).then(function(response){scope.bettyImage=response.data})}),scope.$watch("bettyImage",function(){scope.setStyles()},!0),element.resize(scope.setStyles),scope.removeImage=function(){scope.image.id=null,scope.callImageChangeCallback()},scope.editImage=function(){openImageCropModal(scope.image).then(function(success){console.log(success)})}}}}),angular.module("BettyCropper").controller("ImageCropModalCtrl",function($scope,$timeout,$modalInstance,BettyCropper,Selection,DEFAULT_IMAGE_WIDTH,imageData,ratios){$scope.selectedCrop=null,$scope.cropMode=!1,$scope.ratios=ratios,$scope.finished=!1,$scope.thumb_container_styles={},$scope.imageData=imageData,$scope.image||($scope.image=null,BettyCropper.get(imageData.id).then(function(success){$scope.image=success.data})),$scope.$watch("image",function(image){if(image){var finished=!0;for(var ratio in image.selections)if("auto"===image.selections[ratio].source){finished=!1;break}$scope.finished=finished,$scope.scaleData=image.scaleToFit(550,400),$(".crop-image-container img").one("load",function(){$(this).Jcrop({allowSelect:!1,allowMove:!0,allowResize:!0,keySupport:!1},function(){$scope.jcrop_api=this})}),$scope.image_url=image.url("original",DEFAULT_IMAGE_WIDTH,"jpg"),$scope.ratios||($scope.ratios=Object.keys(image.selections)),$scope.setThumbStyles()}}),$scope.$watch("selectedCrop",function(crop){if($scope.image){var finished=!0;for(var ratio in $scope.image.selections)if("auto"===$scope.image.selections[ratio].source&&ratio!==crop){finished=!1;break}$scope.finished=finished}}),$scope.selectCrop=function(ratio){if(!ratio){ratio=Object.keys($scope.image.selections)[0];for(var key in $scope.image.selections)if("auto"===$scope.image.selections[key].source){ratio=key;break}}var selection=$scope.image.selections[ratio].scaleBy($scope.scaleData.scale);$scope.jcrop_api.setOptions({aspectRatio:selection.width()/selection.height()}),$scope.jcrop_api.setSelect([selection.x0,selection.y0,selection.x1,selection.y1]),$scope.cropMode=!0,$scope.selectedCrop=ratio},$scope.setThumbStyles=function(){$scope.thumb_styles=$scope.thumb_styles||{};for(var ratio in $scope.image.selections){var scaledSelection=$scope.image.selections[ratio].scaleToFit(170,170);$scope.thumb_container_styles[ratio]={"padding-top":Math.round((180-scaledSelection.height())/2)+"px","padding-bottom":"5px","padding-left":Math.round((180-scaledSelection.width())/2)+"px","padding-right":"5px"},$scope.thumb_styles[ratio]=$scope.image.getStyles(170,170,ratio)}},$scope.save=function(ratio){var jcrop_selection=$scope.jcrop_api.tellSelect(),newSelection=new Selection({x0:jcrop_selection.x,x1:jcrop_selection.x2,y0:jcrop_selection.y,y1:jcrop_selection.y2,source:"user"});return newSelection=newSelection.scaleBy(1/$scope.scaleData.scale),newSelection.x1>$scope.image.width&&(newSelection.x1=$scope.image.width),newSelection.y1>$scope.image.height&&(newSelection.y1=$scope.image.height),this.image.updateSelection(ratio,newSelection)},$scope.saveAndQuit=function(){var ratio=$scope.selectedCrop;this.save(ratio).then(function(success){var ratio=success.data[0],selection=success.data[1];$scope.image.selections[ratio]=selection}),$scope.cropMode=!1,$modalInstance.close(imageData)},$scope.saveAndNext=function(){var ratio=$scope.selectedCrop;this.save(ratio).then(function(success){var ratio=success.data[0],selection=success.data[1];$scope.image.selections[ratio]=selection;var nextRatioIndex=($scope.ratios.indexOf(ratio)+1)%$scope.ratios.length;$scope.selectCrop($scope.ratios[nextRatioIndex])})}}),angular.module("BettyCropper").factory("openImageCropModal",function($modal){var openImageCropModal=function(imageData,ratios){return $modal.open({templateUrl:"shared/bettycropper/image-crop-modal.html",controller:"ImageCropModalCtrl",resolve:{imageData:function(){return imageData},ratios:function(){return ratios||!1}},backdrop:"static"}).result};return openImageCropModal}),angular.module("videoHub").filter("convertToLocal",function(){return function(input){return input?moment.utc(input).local().format("YYYY-MM-DD hh:mm A"):input}}),angular.module("videoHub").directive("createContent",function(){return{restrict:"E",templateUrl:"shared/create-content/create-content.html",controller:function($scope,$location){$scope.setContentType=function(contentType){$scope.contentType=contentType},$scope.goToContentTypesCreationPage=function(){$location.path("cms/"+$scope.contentType+"/new/")}}}}),angular.module("videoHub").service("CurrentUser",function(localStorageService,$location){this.currentUser=null,this.getCurrentUser=function(){return localStorageService.get("currentUser")},this.setCurrentUser=function(newCurrentUser){localStorageService.set("currentUser",newCurrentUser)},this.logout=function(){this.currentUser=null,localStorageService.remove("authToken"),localStorageService.remove("currentUser"),$location.path("cms/login/")}}),angular.module("videoHub").directive("dateTimeSelector",function($modal){return{link:function(scope,element){var modalInstance=null;element.addClass("datetime-selection-modal-opener"),element.on("click",function(){modalInstance=$modal.open({templateUrl:"shared/date-time-selector/date-time-selector-modal.html",controller:"DateTimeSelectorModalController",scope:scope}),modalInstance.result.then(function(newDate){scope.modDateTime=newDate,scope.dateTimeSelectorModalOnClose&&scope.dateTimeSelectorModalOnClose(newDate)})})},restrict:"A",require:"^ngModel",scope:{modDateTime:"=ngModel",dateTimeSelectorModalTitle:"@",dateTimeSelectorModalOnClose:"="}}}),angular.module("videoHub").filter("dateTimeSelectorFormatter",function(){return function(input){return input?moment(input).format("L @ hh:mm"):input}}),angular.module("videoHub").controller("DateTimeSelectorModalController",function(moment,$scope,$modalInstance,TIMEZONE_NAME){$scope.dateValid=!1,$scope.$watch("tempDateTime",function(){$scope.dateValid=!_.isNull($scope.tempDateTime)||moment($scope.tempDateTime).isValid()}),$scope.tempDateTime=angular.copy($scope.modDateTime),$scope.TIMEZONE_LABEL=moment.tz(TIMEZONE_NAME).format("z");var timeNowWithOffset=function(){return moment.tz(TIMEZONE_NAME)};$scope.setDate=function(newDate){$scope.tempDateTime=moment(newDate)},$scope.setDateToday=function(){var now=timeNowWithOffset();$scope.tempDateTime=moment().year(now.year()).month(now.month()).date(now.date())},$scope.setDateTomorrow=function(){var now=timeNowWithOffset();$scope.tempDateTime=moment().year(now.year()).month(now.month()).date(now.date()+1)},$scope.setTimeNow=function(){$scope.tempDateTime=timeNowWithOffset()},$scope.setTimeMidnight=function(){$scope.tempDateTime=timeNowWithOffset().hour(24).minute(0)},$scope.clearDateTime=function(){var confirm=window.confirm("Are you sure you wish to unpublish this?");confirm&&$modalInstance.close(null)},$scope.chooseDateTime=function(){if($scope.dateValid){var retMoment=moment($scope.tempDateTime);$modalInstance.close(retMoment)}else console.error("Attempting to choose invalid date.")}}),angular.module("videoHub").controller("DeleteModalController",function($scope,SponsorService,$modalInstance){SponsorService.getList().then(function(data){$scope.sponsors=data}),$scope.selectSponsor=function(sponsor){$scope.sponsor=sponsor},$scope.clearSponsor=function(){$scope.sponsor=null},$scope.close=function(){$modalInstance.close(!0)}}),angular.module("videoHub").directive("deleteModal",function($modal){return{link:function(scope,element){var modalInstance=null;element.addClass("delete-modal-opener"),element.on("click",function(){modalInstance=$modal.open({templateUrl:"shared/delete-modal/delete-modal.html",controller:"DeleteModalController",scope:scope}),modalInstance.result.then(function(confirm){confirm&&scope.confirmCallback()})})},restrict:"A",scope:{confirmCallback:"="}}}),angular.module("videoHub").directive("detailsNavBar",function(){return{restrict:"E",templateUrl:"shared/detailsnavbar/detailsnavbar.html",transclude:!0,scope:{deleteCallback:"=",sponsor:"=",hideDeleteButton:"=",hideSponsorButton:"=",hidePublishButton:"=",save:"=saveFunction",published:"=",toolsDropdownText:"=",sponsorSelectionModalOnClose:"&",dateTimeSelectorModalOnClose:"=",isDirty:"="},controller:function($scope,$rootScope,logoUrl,$location,CurrentUser,TIMEZONE_NAME,SaveButtonStateService){$scope.logoUrl=logoUrl,$scope.currentUserName=CurrentUser.getCurrentUser(),$scope.TIMEZONE_LABEL=moment.tz(TIMEZONE_NAME).format("z"),$scope.data={},$scope.data=SaveButtonStateService.data}}}),angular.module("videoHub").constant("SAVE_BUTTON_STATES",{SAVING:"saving",SAVED:"saved"}).service("SaveButtonStateService",function($timeout,$q,SAVE_BUTTON_STATES){this.data={},this.data.saveButtonState="";var SaveButtonStateService=this,setStateToSaving=function(){SaveButtonStateService.data.saveButtonState=SAVE_BUTTON_STATES.SAVING},setStateToSaved=function(){SaveButtonStateService.data.saveButtonState=SAVE_BUTTON_STATES.SAVED},clearState=function(){SaveButtonStateService.data.saveButtonState=""};this.displaySavingAnimation=function(){var defer=$q.defer();return setStateToSaving(),$timeout(setStateToSaved,2e3).then(function(){$timeout(clearState,1e3).then(function(){defer.resolve()})}),defer.promise}}),angular.module("videoHub").directive("dropdownSelector",["$injector",function($injector){return{templateUrl:"shared/dropdownselector/dropdownselector.html",scope:{ngModel:"=",ngRequired:"@",service:"@",placeholderText:"@"},controller:function($scope){var service=$injector.get($scope.service);$scope.populateCurrentItemsList=function(){service.getList({page_size:100}).then(function(results){$scope.currentItems=results})},$scope.populateCurrentItemsList()}}}]),angular.module("videoHub").directive("filterButtons",["ListService",function(ListService){return{controller:function($scope){$scope.params=ListService.getParams(),$scope.setFilterAndUpdateList=function(newFilterValue){return ListService.setFilter(newFilterValue),$scope.params=ListService.getParams(),ListService.updateList().then(function(){$scope.updateCallback&&$scope.updateCallback()})}},restrict:"E",scope:{updateCallback:"&"},templateUrl:"shared/filter-buttons/filter-buttons.html"}}]),angular.module("videoHub").directive("listNavBar",function(){return{restrict:"E",templateUrl:"shared/listnavbar/listnavbar.html",controller:function($scope,$rootScope,logoUrl,$location,CurrentUser){$scope.logoUrl=logoUrl,$scope.currentUserName=CurrentUser.getCurrentUser(),$scope.logout=function(){CurrentUser.logout()}}}}),angular.module("videoHub").service("ListService",function($location,$injector,ValidQueryParamsForListPage){this.data={};var ListService=this;this.service=null;var currentService=null;this.getParams=function(){return this.data.params},this.setService=function(serviceName){this.service=$injector.get(serviceName),currentService=this.service,this.data.params=$location.search(),this.data.list=[],this.data.totalItems=0},this.clearSearch=function(){this.data.params.q=""},this.setFilter=function(newFilterValue){this.data.params.f=newFilterValue},this.setList=function(list){ListService.data.list=list,list.meta?ListService.data.totalItems=list.meta.count:(list.meta={},list.meta.count=0)},this.setSearch=function(searchQuery){this.data.params.q=searchQuery},this.setOrder=function(newOrderValue){var orderBy=this.data.params.order_by;orderBy?orderBy.indexOf(newOrderValue)>-1&&-1===orderBy.indexOf("-")?orderBy="-"+newOrderValue:orderBy.indexOf(newOrderValue)>-1&&(orderBy=null):orderBy=newOrderValue,this.data.params.order_by=orderBy},this.setPage=function(pageNumber){this.data.params.page=pageNumber},this.updateList=function(){return this.data.params=_.pick(this.data.params,ValidQueryParamsForListPage),this.data.params=_.omit(this.data.params,function(value){return _.isEmpty(value)&&!_.isNumber(value)}),$location.search(this.data.params),currentService.getList(this.data.params).then(ListService.setList)}}),angular.module("videoHub").directive("navDropdown",[function(){return{controller:function($scope){$scope.sections=[{href:"cms/",title:"Videos"},{href:"cms/series/",title:"Series"},{href:"cms/channels/",title:"Channels"},{href:"cms/sponsors/",title:"Sponsors"},{href:"cms/sliders/",title:"Sliders"}]},restrict:"E",scope:{active:"@"},templateUrl:"shared/nav-dropdown/nav-dropdown.html"}}]),function(){var module,moduleName="videoHub",DEFAULT_ID="__default";try{module=angular.module(moduleName)}catch(err){module=angular.module(moduleName,[])}module.directive("dirPaginate",["$compile","$parse","$timeout","paginationService",function($compile,$parse,$timeout,paginationService){return{terminal:!0,multiElement:!0,priority:5e3,compile:function(tElement,tAttrs){var expression=tAttrs.dirPaginate,match=expression.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),filterPattern=/\|\s*itemsPerPage\s*:[^|]*/;if(null===match[2].match(filterPattern))throw"pagination directive: the 'itemsPerPage' filter must be set.";var itemsPerPageFilterRemoved=match[2].replace(filterPattern,""),collectionGetter=$parse(itemsPerPageFilterRemoved),rawId=tAttrs.paginationId||DEFAULT_ID;return paginationService.registerInstance(rawId),function(scope,element,attrs){var paginationId=$parse(attrs.paginationId)(scope)||attrs.paginationId||DEFAULT_ID;paginationService.registerInstance(paginationId);var repeatExpression,idDefinedInFilter=!!expression.match(/(\|\s*itemsPerPage\s*:[^|]*:[^|]*)/);repeatExpression=paginationId===DEFAULT_ID||idDefinedInFilter?expression:expression.replace(/(\|\s*itemsPerPage\s*:[^|]*)/,"$1 : '"+paginationId+"'"),element[0].hasAttribute("dir-paginate-start")||element[0].hasAttribute("data-dir-paginate-start")?(attrs.$set("ngRepeatStart",repeatExpression),element.eq(element.length-1).attr("ng-repeat-end",!0)):attrs.$set("ngRepeat",repeatExpression);var currentPageGetter,compiled=$compile(element,!1,5e3);if(attrs.currentPage)currentPageGetter=$parse(attrs.currentPage);else{var defaultCurrentPage=paginationId+"__currentPage";scope[defaultCurrentPage]=1,currentPageGetter=$parse(defaultCurrentPage)}paginationService.setCurrentPageParser(paginationId,currentPageGetter,scope),"undefined"!=typeof attrs.totalItems?(paginationService.setAsyncModeTrue(paginationId),scope.$watch(function(){return $parse(attrs.totalItems)(scope)},function(result){result>=0&&paginationService.setCollectionLength(paginationId,result)})):scope.$watchCollection(function(){return collectionGetter(scope)},function(collection){collection&&paginationService.setCollectionLength(paginationId,collection.length)}),compiled(scope)}}}}]),module.directive("dirPaginationControls",["paginationService","paginationTemplate",function(paginationService,paginationTemplate){function generatePagesArray(currentPage,collectionLength,rowsPerPage,paginationRange){var position,pages=[],totalPages=Math.ceil(collectionLength/rowsPerPage),halfWay=Math.ceil(paginationRange/2);position=halfWay>=currentPage?"start":currentPage>totalPages-halfWay?"end":"middle";for(var ellipsesNeeded=totalPages>paginationRange,i=1;totalPages>=i&&paginationRange>=i;){var pageNumber=calculatePageNumber(i,currentPage,paginationRange,totalPages),openingEllipsesNeeded=2===i&&("middle"===position||"end"===position),closingEllipsesNeeded=i===paginationRange-1&&("middle"===position||"start"===position);pages.push(ellipsesNeeded&&(openingEllipsesNeeded||closingEllipsesNeeded)?"...":pageNumber),i++}return pages}function calculatePageNumber(i,currentPage,paginationRange,totalPages){var halfWay=Math.ceil(paginationRange/2);return i===paginationRange?totalPages:1===i?i:totalPages>paginationRange?currentPage>totalPages-halfWay?totalPages-paginationRange+i:currentPage>halfWay?currentPage-halfWay+i:i:i}var numberRegex=/^\d+$/;return{restrict:"AE",templateUrl:function(elem,attrs){return attrs.templateUrl||paginationTemplate.getPath()},scope:{maxSize:"=?",onPageChange:"&?",paginationId:"=?"},link:function(scope,element,attrs){function goToPage(num){isValidPageNumber(num)&&(scope.pages=generatePagesArray(num,paginationService.getCollectionLength(paginationId),paginationService.getItemsPerPage(paginationId),paginationRange),scope.pagination.current=num,updateRangeValues(),scope.onPageChange&&scope.onPageChange({newPageNumber:num}))}function generatePagination(){var page=parseInt(paginationService.getCurrentPage(paginationId))||1;scope.pages=generatePagesArray(page,paginationService.getCollectionLength(paginationId),paginationService.getItemsPerPage(paginationId),paginationRange),scope.pagination.current=page,scope.pagination.last=scope.pages[scope.pages.length-1],scope.pagination.last<scope.pagination.current?scope.setCurrent(scope.pagination.last):updateRangeValues()}function updateRangeValues(){var currentPage=paginationService.getCurrentPage(paginationId),itemsPerPage=paginationService.getItemsPerPage(paginationId),totalItems=paginationService.getCollectionLength(paginationId);scope.range.lower=(currentPage-1)*itemsPerPage+1,scope.range.upper=Math.min(currentPage*itemsPerPage,totalItems),scope.range.total=totalItems}function isValidPageNumber(num){return numberRegex.test(num)&&num>0&&num<=scope.pagination.last}var rawId=attrs.paginationId||DEFAULT_ID,paginationId=scope.paginationId||attrs.paginationId||DEFAULT_ID;if(!paginationService.isRegistered(paginationId)&&!paginationService.isRegistered(rawId)){var idMessage=paginationId!==DEFAULT_ID?" (id: "+paginationId+") ":" ";throw"pagination directive: the pagination controls"+idMessage+"cannot be used without the corresponding pagination directive."}scope.maxSize||(scope.maxSize=9),scope.directionLinks=angular.isDefined(attrs.directionLinks)?scope.$parent.$eval(attrs.directionLinks):!0,scope.boundaryLinks=angular.isDefined(attrs.boundaryLinks)?scope.$parent.$eval(attrs.boundaryLinks):!1;var paginationRange=Math.max(scope.maxSize,5);scope.pages=[],scope.pagination={last:1,current:1},scope.range={lower:1,upper:1,total:1},scope.$watch(function(){return(paginationService.getCollectionLength(paginationId)+1)*paginationService.getItemsPerPage(paginationId)},function(length){length>0&&generatePagination()}),scope.$watch(function(){return paginationService.getItemsPerPage(paginationId)},function(current,previous){current!=previous&&goToPage(scope.pagination.current)}),scope.$watch(function(){return paginationService.getCurrentPage(paginationId)},function(currentPage,previousPage){currentPage!=previousPage&&goToPage(currentPage)}),scope.setCurrent=function(num){isValidPageNumber(num)&&paginationService.setCurrentPage(paginationId,num)}}}}]),module.filter("itemsPerPage",["paginationService",function(paginationService){return function(collection,itemsPerPage,paginationId){if("undefined"==typeof paginationId&&(paginationId=DEFAULT_ID),!paginationService.isRegistered(paginationId))throw"pagination directive: the itemsPerPage id argument (id: "+paginationId+") does not match a registered pagination-id.";var end,start;return collection instanceof Array?(itemsPerPage=parseInt(itemsPerPage)||9999999999,start=paginationService.isAsyncMode(paginationId)?0:(paginationService.getCurrentPage(paginationId)-1)*itemsPerPage,end=start+itemsPerPage,paginationService.setItemsPerPage(paginationId,itemsPerPage),collection.slice(start,end)):collection}}]),module.service("paginationService",function(){var lastRegisteredInstance,instances={};this.registerInstance=function(instanceId){"undefined"==typeof instances[instanceId]&&(instances[instanceId]={asyncMode:!1},lastRegisteredInstance=instanceId)},this.isRegistered=function(instanceId){return"undefined"!=typeof instances[instanceId]},this.getLastInstanceId=function(){return lastRegisteredInstance},this.setCurrentPageParser=function(instanceId,val,scope){instances[instanceId].currentPageParser=val,instances[instanceId].context=scope},this.setCurrentPage=function(instanceId,val){instances[instanceId].currentPageParser.assign(instances[instanceId].context,val)},this.getCurrentPage=function(instanceId){var parser=instances[instanceId].currentPageParser;return parser?parser(instances[instanceId].context):1},this.setItemsPerPage=function(instanceId,val){instances[instanceId].itemsPerPage=val},this.getItemsPerPage=function(instanceId){return instances[instanceId].itemsPerPage},this.setCollectionLength=function(instanceId,val){instances[instanceId].collectionLength=val},this.getCollectionLength=function(instanceId){return instances[instanceId].collectionLength},this.setAsyncModeTrue=function(instanceId){instances[instanceId].asyncMode=!0},this.isAsyncMode=function(instanceId){return instances[instanceId].asyncMode}}),module.provider("paginationTemplate",function(){var templatePath="shared/pagination/dirPagination.tpl.html";this.setPath=function(path){templatePath=path},this.$get=function(){return{getPath:function(){return templatePath}}}})}(),angular.module("videoHub").controller("SponsorSelectorModalController",function($scope,SponsorService,$modalInstance){SponsorService.getList().then(function(data){$scope.sponsors=data}),$scope.selectSponsor=function(sponsor){$scope.sponsor=sponsor},$scope.clearSponsor=function(){$scope.sponsor=null},$scope.close=function(){$modalInstance.close($scope.sponsor)}}),angular.module("videoHub").directive("sponsorSelector",function($modal){return{link:function(scope,element){var modalInstance=null;element.addClass("sponsor-selection-modal-opener"),element.on("click",function(){modalInstance=$modal.open({templateUrl:"shared/sponsor-selection-modal/sponsor-selection-modal.html",controller:"SponsorSelectorModalController",scope:scope}),modalInstance.result.then(function(newSponsor){scope.sponsor=newSponsor,_.isFunction(scope.sponsorSelectionModalOnClose)&&scope.sponsorSelectionModalOnClose({sponsor:newSponsor})})})},restrict:"A",require:"^ngModel",scope:{sponsor:"=ngModel",sponsorSelectonModalTitle:"@",sponsorSelectionModalOnClose:"&"}}}),angular.module("videoHub").directive("tagsAutocomplete",function($injector){return{templateUrl:"shared/tags-autocomplete/tags-autocomplete.html",scope:{items:"=",service:"@service",labelAttr:"@",placeholderText:"@"},controller:function($scope,AlertService){var service=$injector.get($scope.service);$scope.fetchItemsThatMatchSearch=function(){_.isEmpty($scope.search)||$scope.search.length<2?$scope.currentItems=[]:($scope.tagsAreBeingFetchedFromTheServer=!0,service.getList({q:$scope.search}).then($scope.updateCurrentItemsAndDisplayDropdown,function(){AlertService.error("Somethign went wrong. Please contact your friendly sysadmin",!0)}))},$scope.updateCurrentItemsAndDisplayDropdown=function(data){if($scope.tagsAreBeingFetchedFromTheServer=!1,_.isUndefined(data))$scope.currentItems=null;else{var currentItemsIds=_.pluck($scope.items,"id");data=_.reject(data,function(item){return _.contains(currentItemsIds,item.id)}),$scope.currentItems=data}},$scope.clearSearch=function(){$scope.search="",$scope.currentItems=[],$scope.fetchItemsThatMatchSearch(),$scope.selectedElement=-1},$scope.selectedElement=-1,$scope.controlSelectedElementWithKeyboard=function(event){var keyCode=event.keyCode;if(!_.isEmpty($scope.search)){var lastIndexOfCurrentItems=$scope.currentItems.length-1;switch(keyCode){case 27:$scope.clearSearch();break;case 40:$scope.selectedElement=$scope.selectedElement>=lastIndexOfCurrentItems?0:$scope.selectedElement+1;break;case 38:$scope.selectedElement=$scope.selectedElement<=0?lastIndexOfCurrentItems:$scope.selectedElement-1;break;case 13:$scope.tagsAreBeingFetchedFromTheServer||($scope.addItem($scope.currentItems[$scope.selectedElement]),$scope.selectedElement=-1);
break;default:return}}},$scope.addItem=function(item){if(_.isUndefined(item)){item={name:$scope.search};var isCurrentTagInCurrentItemsPredicate=_.matches(item),currentObjectFetchedFromCurrentItems=_.find($scope.currentItems,isCurrentTagInCurrentItemsPredicate);currentObjectFetchedFromCurrentItems?$scope.items.push(currentObjectFetchedFromCurrentItems):service.post(item).then(function(data){$scope.items.push(data),$scope.clearSearch()},function(){AlertService.error("Something went wrong. Plase contact your friendly sysadmin.",!0)})}else $scope.items.push(item);$scope.clearSearch()},$scope.removeItem=function(itemToBeRemovedFromArray){$scope.items=_.reject($scope.items,function(item){return item.id===itemToBeRemovedFromArray.id})}}}}),angular.module("videoHub").filter("tzDate",function(dateFilter,moment,TIMEZONE_NAME){return function(input,format){if(!input)return"";var inDate=moment.tz(input,TIMEZONE_NAME),newdate=inDate.format("YYYY-MM-DDTHH:mm"),formattedDate=dateFilter(newdate,format);return formattedDate}}),angular.module("videoHub").directive("videoPlayer",[function(){return{replace:!1,restrict:"E",transclude:!0,templateUrl:"shared/videoplayer/videoplayer.html",link:function(scope,element){var currentVideo=element.find("video")[0];scope.player=videojs(currentVideo,{controls:!0,autoplay:!1,width:"auto",height:"auto"}),element.find(".modal").on("hidden.bs.modal",function(){scope.player.pause()}),scope.$on("$destroy",function(){scope.player.dispose()})}}}]);
//# sourceMappingURL=app.min.js.map